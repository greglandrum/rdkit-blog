<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2021-07-06">
<meta name="description" content="An approximation to make working with count vectors more efficient">

<title>Simulating count fingerprints – RDKit blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../posts/icons/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-53e29d70f03623de13ab2376923601bc.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-49b061ee4cc441246235e07f99f67764.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">RDKit blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">RDKit experiments, tips, and tutorials</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rdkit/rdkit"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/rdkit.bsky.social"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/8192558/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#bit-vector-similarity-vs-count-based-similarity" id="toc-bit-vector-similarity-vs-count-based-similarity" class="nav-link active" data-scroll-target="#bit-vector-similarity-vs-count-based-similarity">Bit vector similarity vs count-based similarity</a></li>
  <li><a href="#simulating-counts" id="toc-simulating-counts" class="nav-link" data-scroll-target="#simulating-counts">Simulating counts</a></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion" class="nav-link" data-scroll-target="#results-and-discussion">Results and discussion</a>
  <ul class="collapse">
  <li><a href="#random-pairs" id="toc-random-pairs" class="nav-link" data-scroll-target="#random-pairs">Random pairs</a></li>
  <li><a href="#related-pairs" id="toc-related-pairs" class="nav-link" data-scroll-target="#related-pairs">Related pairs</a></li>
  </ul></li>
  <li><a href="#some-technical-notes" id="toc-some-technical-notes" class="nav-link" data-scroll-target="#some-technical-notes">Some technical notes:</a></li>
  <li><a href="#construct-the-dataset." id="toc-construct-the-dataset." class="nav-link" data-scroll-target="#construct-the-dataset.">Construct the dataset.</a></li>
  <li><a href="#performance-of-similarity-comparisons" id="toc-performance-of-similarity-comparisons" class="nav-link" data-scroll-target="#performance-of-similarity-comparisons">Performance of similarity comparisons</a></li>
  <li><a href="#morgan-2" id="toc-morgan-2" class="nav-link" data-scroll-target="#morgan-2">Morgan 2</a></li>
  <li><a href="#topological-torsions" id="toc-topological-torsions" class="nav-link" data-scroll-target="#topological-torsions">Topological Torsions</a></li>
  <li><a href="#atom-pairs" id="toc-atom-pairs" class="nav-link" data-scroll-target="#atom-pairs">Atom pairs</a></li>
  <li><a href="#rdkit-fingerprint" id="toc-rdkit-fingerprint" class="nav-link" data-scroll-target="#rdkit-fingerprint">RDKit Fingerprint</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simulating count fingerprints</h1>
  <div class="quarto-categories">
    <div class="quarto-category">fingerprints</div>
    <div class="quarto-category">technical</div>
    <div class="quarto-category">reference</div>
  </div>
  </div>

<div>
  <div class="description">
    An approximation to make working with count vectors more efficient
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 6, 2021</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Many of the RDKit’s fingerprints are available as either bit vectors or count vectors. Bit vectors track whether or not features appear in a molecule while count vectors track the number of times each feature appears. It seems intuitive that a count vector is a better representation of similarity than bit vectors, but we often use bit vector representations for computational expediency - bit vectors require less memory and are much faster to operate on.</p>
<p>What impact does this using bit vectors have on computed similarity values and the ordering of similarities? This notebook attempts to provide at least a partial answer to that question and also examines a strategy for simulating counts using bit vectors. I look at the following fingerprints: - Morgan 2 - Topological Torsion - Atom Pair - RDKit</p>
<p>And I use two sets of compunds: - Random pairs of compounds taken from <a href="https://greglandrum.github.io/rdkit-blog/fingerprints/similarity/reference/2021/05/18/fingerprint-thresholds1.html">this blog post</a> - Pairs of “related compounds” taken from <a href="https://greglandrum.github.io/rdkit-blog/similarity/reference/2021/05/21/similarity-search-thresholds.html">this blog post</a></p>
<section id="bit-vector-similarity-vs-count-based-similarity" class="level2">
<h2 class="anchored" data-anchor-id="bit-vector-similarity-vs-count-based-similarity">Bit vector similarity vs count-based similarity</h2>
<p>Let’s start with two molecules where this makes a big difference:</p>
<p><img src="images/blog/simulating-counts1-2.png" class="img-fluid"></p>
<p>The calculated similarity with MFP2 and counts is 0.6 while with bits it’s 0.29. That’s easy to understand since with the bit-based fingerprints the long alkyl chains don’t make the large ontribution to the similarity that they do when using counts.</p>
<p>To demonstrate that this isn’t all about long chains, here’s another pair where there’s a significant difference:</p>
<p><img src="images/blog/simulating-counts1-3.png" class="img-fluid"></p>
<p>In this case the count-based similarity is 0.59 while with bits it’s 0.35.</p>
<p>Those were a couple of anecdotes, but let’s look at the differences across the entire datasets:</p>
<p><img src="images/blog/simulating-counts1-4.png" class="img-fluid"></p>
<p>Here I’ve plotted bit-based similarity vs count-based similarity and included statistics on the correlation in the title. The left plot is for the random compound pairs and the right plot is for the related compound pairs. There are significant differences in similarity here, with the bit vector similarities being consistently lower than the count-based equivalent, but it’s worth pointing out that the rankings of the similarities (as measured by the Spearman rank-order correlation values) are reasonably equivalent, particularly for the related compound pairs.</p>
<p>The equivalent plots for the RDKit fingerprint show the same qualitative behavior with the difference that bit vector similarities tend to be <em>higher</em> than count based similarities:</p>
<p><img src="images/blog/simulating-counts1-5.png" class="img-fluid"></p>
</section>
<section id="simulating-counts" class="level2">
<h2 class="anchored" data-anchor-id="simulating-counts">Simulating counts</h2>
<p>The RDKit has a simple mechanism for simulating counts using bit vectors: set multiple bits for each feature where the number of bits set is determined by the count. The approach uses a fixed number of potential bits which each have a threshold value; if the count for the feature exceeds the threshold value then the corresponding bit is set. Here’s a schematic illustration for count simulation with four bits and the thresholds 1, 2, 4, and 8:</p>
<p><img src="images/blog/simulating-counts1-6.png" class="img-fluid"></p>
<p>The example shown, with the first two bits set for feature N, is what we’d get if feature N is set either 2 or 3 times in a molecule. Note that we aren’t just using a binary representation of the count itself. In that case a feature which is present one time in the first molecule, representation <code>1000</code>, and two times in the second molecule, representation <code>0100</code>, would contribute zero to the overall similarity. That’s not desirable.</p>
<p>Note that since the count simulation approach uses multiple bits per feature, it decreases the effective length of the fingerprint by a factor equal to the number of bits used. With the default setting of four bits per feature a 2048 bit fingerprint will have the same number of bit collisions as a 512 bit fingerprint without count simulation. This becomes more relevant the more bits a fingerprint tends to set. For example using count simulation to calculate similarity with the RDKit fingerprint, which <a href="https://greglandrum.github.io/rdkit-blog/fingerprints/reference/2021/07/06/number-of-fp-bits-set.html">sets a large number of bits</a>, actually decreases the correlation with the similarity calculated with count vectors (see below for the plot) unless I also increase the overall length of the fingerprint.</p>
</section>
<section id="results-and-discussion" class="level2">
<h2 class="anchored" data-anchor-id="results-and-discussion">Results and discussion</h2>
<p>Here’s a summary of the results for the fingerprints I examine here</p>
<section id="random-pairs" class="level3">
<h3 class="anchored" data-anchor-id="random-pairs">Random pairs</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th>Fingerprint</th>
<th>bits Spearman r</th>
<th>bits MAE</th>
<th>bits RMSE</th>
<th>count-simulation Spearman r</th>
<th>count-simulation MAE</th>
<th>count-simulation RMSE</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Morgan 2</td>
<td>0.84</td>
<td>0.097</td>
<td>0.10</td>
<td>0.90</td>
<td>0.024</td>
<td>0.036</td>
<td></td>
</tr>
<tr class="even">
<td>Topological torsions</td>
<td>0.92</td>
<td>0.026</td>
<td>0.051</td>
<td>0.98</td>
<td>0.018</td>
<td>0.029</td>
<td></td>
</tr>
<tr class="odd">
<td>Topological torsions</td>
<td>0.92</td>
<td>0.026</td>
<td>0.051</td>
<td>0.99</td>
<td>0.010</td>
<td>0.021</td>
<td>8192 bits for count simulation</td>
</tr>
<tr class="even">
<td>Atom pairs</td>
<td>0.82</td>
<td>0.031</td>
<td>0.049</td>
<td>0.90</td>
<td>0.055</td>
<td>0.066</td>
<td></td>
</tr>
<tr class="odd">
<td>Atom pairs</td>
<td>0.82</td>
<td>0.031</td>
<td>0.049</td>
<td>0.96</td>
<td>0.014</td>
<td>0.023</td>
<td>8192 bits for count simulation</td>
</tr>
<tr class="even">
<td>RDKit</td>
<td>0.83</td>
<td>0.079</td>
<td>0.10</td>
<td>0.94</td>
<td>0.029</td>
<td>0.045</td>
<td>8192 bits for count simulation</td>
</tr>
</tbody>
</table>
</section>
<section id="related-pairs" class="level3">
<h3 class="anchored" data-anchor-id="related-pairs">Related pairs</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th>Fingerprint</th>
<th>bits Spearman r</th>
<th>bits MAE</th>
<th>bits RMSE</th>
<th>count-simulation Spearman r</th>
<th>count-simulation MAE</th>
<th>count-simulation RMSE</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Morgan 2</td>
<td>0.94</td>
<td>0.043</td>
<td>0.062</td>
<td>0.98</td>
<td>0.019</td>
<td>0.028</td>
<td></td>
</tr>
<tr class="even">
<td>Topological torsions</td>
<td>0.90</td>
<td>0.050</td>
<td>0.079</td>
<td>0.98</td>
<td>0.021</td>
<td>0.035</td>
<td></td>
</tr>
<tr class="odd">
<td>Topological torsions</td>
<td>0.90</td>
<td>0.050</td>
<td>0.079</td>
<td>0.98</td>
<td>0.018</td>
<td>0.032</td>
<td>8192 bits for count simulation</td>
</tr>
<tr class="even">
<td>Atom pairs</td>
<td>0.91</td>
<td>0.043</td>
<td>0.067</td>
<td>0.97</td>
<td>0.052</td>
<td>0.063</td>
<td></td>
</tr>
<tr class="odd">
<td>Atom pairs</td>
<td>0.91</td>
<td>0.043</td>
<td>0.067</td>
<td>0.98</td>
<td>0.020</td>
<td>0.032</td>
<td>8192 bits for count simulation</td>
</tr>
<tr class="even">
<td>RDKit</td>
<td>0.91</td>
<td>0.077</td>
<td>0.11</td>
<td>0.98</td>
<td>0.034</td>
<td>0.053</td>
<td>8192 bits for count simulation</td>
</tr>
</tbody>
</table>
<p>Using the count simulation strategies does improve the match between similarities calculated with bit vectors and those calculated with count vectors. The differences are statistically significant (results not shown here) and large enough to potentially be meaningful. MAE and RMSE values for the various fingerprints typically decrease by at least a factor of two and Spearman rank-order correlation in general increases quite a bit. These conclusions hold for both randomly paired molecules and related pairs with more dramatic differences seen at the lower ends of the similarity scale (the random pairs).</p>
<p>Note that this analysis focuses solely on similarity. The extra information added by doing count simulation will most likely also influence the performance of machine learning models built using these fingerprints. But that’s for a future blog post.</p>
<p>The code to reproduce all of this, along with more plots, is below.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> rdFingerprintGenerator</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> rdMolDescriptors</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> DataStructs</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> Draw</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> rdDepictor</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>rdDepictor.SetPreferCoordGen(<span class="va">True</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> spearmanr</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> median_absolute_error, mean_squared_error</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rdkit</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdkit.__version__)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pylab inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2021.09.1pre
Populating the interactive namespace from numpy and matplotlib</code></pre>
</div>
</div>
</section>
</section>
<section id="some-technical-notes" class="level2">
<h2 class="anchored" data-anchor-id="some-technical-notes">Some technical notes:</h2>
<ul>
<li>Note that this notebook uses a couple of features which did not work properly until the v2021.03.4 of the RDKit (which will be released in July).</li>
<li>Count simulation is only generally available when working with the “new” fingerprint generators, so those are used throughout this notebook.</li>
<li>Count simulation is used by default for atom pair and topological torsion fingerprints, both with the “new” fingerprint generators and the older fingerprinting functions.</li>
</ul>
</section>
<section id="construct-the-dataset." class="level2">
<h2 class="anchored" data-anchor-id="construct-the-dataset.">Construct the dataset.</h2>
<p>Start with our standard similarity comparison set:</p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">'../data/chembl21_25K.pairs.txt.gz'</span>,<span class="st">'rt'</span>) <span class="im">as</span> inf:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    ls <span class="op">=</span> [x.split() <span class="cf">for</span> x <span class="kw">in</span> inf.readlines()]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>ms <span class="op">=</span> [(Chem.MolFromSmiles(x[<span class="dv">1</span>]),Chem.MolFromSmiles(x[<span class="dv">3</span>])) <span class="cf">for</span> x <span class="kw">in</span> ls]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s weighted towards lower similarity values, get some pairs from the related compounds set:</p>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> namedtuple</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>MCSRes<span class="op">=</span>namedtuple(<span class="st">'MCSRes'</span>,(<span class="st">'smarts'</span>,<span class="st">'numAtoms'</span>,<span class="st">'numMols'</span>,<span class="st">'avgNumMolAtoms'</span>,<span class="st">'mcsTime'</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'../data/scaffolds_revisited_again.simplified.pkl'</span>,<span class="st">'rb'</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'../data/scaffolds_expanded.simplified.pkl'</span>,<span class="st">'rb'</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">+=</span> data2</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only sets where the MCS was at least 50% of the average number of atoms:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>keep <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> data <span class="cf">if</span> x[<span class="dv">2</span>].numAtoms<span class="op">&gt;=</span>np.mean(x[<span class="dv">2</span>].avgNumMolAtoms)<span class="op">/</span><span class="dv">2</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(keep)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="bn">0xf00d</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>related_pairs <span class="op">=</span> []</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only molecules matching the MCS:</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,tpl <span class="kw">in</span> <span class="bu">enumerate</span>(keep):</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    assay,smis,mcs,svg <span class="op">=</span> tpl</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    patt <span class="op">=</span> Chem.MolFromSmarts(mcs.smarts)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    smis <span class="op">=</span> [(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> smis <span class="cf">if</span> Chem.MolFromSmiles(y).HasSubstructMatch(patt)]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    ssmis <span class="op">=</span> smis[:]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    random.shuffle(ssmis)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    related_pairs.extend([(x[<span class="dv">0</span>],x[<span class="dv">1</span>],y[<span class="dv">0</span>],y[<span class="dv">1</span>]) <span class="cf">for</span> x,y <span class="kw">in</span> <span class="bu">zip</span>(smis,ssmis)][:<span class="dv">10</span>])</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span><span class="bu">len</span>(related_pairs)<span class="sc">}</span><span class="ss"> related pairs'</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>related_ms <span class="op">=</span> [(Chem.MolFromSmiles(x[<span class="dv">1</span>]),Chem.MolFromSmiles(x[<span class="dv">3</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10470 related pairs</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(ms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>25000</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="bn">0xf00d</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(ms)))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>random.shuffle(indices)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>random_pairs <span class="op">=</span> [ms[x] <span class="cf">for</span> x <span class="kw">in</span> indices[:<span class="dv">5000</span>]]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(related_ms)))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>random.shuffle(indices)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>related_pairs <span class="op">=</span> [related_ms[x] <span class="cf">for</span> x <span class="kw">in</span> indices[:<span class="dv">5000</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="performance-of-similarity-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="performance-of-similarity-comparisons">Performance of similarity comparisons</h2>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fpgen <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>bv_pairs <span class="op">=</span> [(fpgen.GetFingerprint(x[<span class="dv">0</span>]),fpgen.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>cv_pairs <span class="op">=</span> [(fpgen.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> bv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5.06 ms ± 75 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> cv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8.37 ms ± 160 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<p>Not a huge difference there, but what about a fingerprint which sets a much larger number of bits?</p>
<div id="cell-15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fpgen <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>bv_pairs <span class="op">=</span> [(fpgen.GetFingerprint(x[<span class="dv">0</span>]),fpgen.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>cv_pairs <span class="op">=</span> [(fpgen.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> bv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6.22 ms ± 404 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> cv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>189 ms ± 1.53 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</code></pre>
</div>
</div>
<p>Here the performance difference is quite noticeable.</p>
</section>
<section id="morgan-2" class="level2">
<h2 class="anchored" data-anchor-id="morgan-2">Morgan 2</h2>
<div id="cell-20" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>delts <span class="op">=</span> <span class="bu">sorted</span>([(countsims[i]<span class="op">-</span>fpsims[i],i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(fpsims))])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[:<span class="dv">5</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[(-0.20329670329670324, 12408), (-0.19358178053830222, 14793), (-0.19191919191919193, 126), (-0.17673378076062635, 1391), (-0.17493796526054584, 13034)]
[(0.31300539083557954, 20013), (0.3151412702245835, 12445), (0.3157622739018088, 13430), (0.3207792207792208, 4381), (0.37206896551724133, 11692)]</code></pre>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">13430</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Count: </span><span class="sc">{</span>countsims[idx]<span class="sc">:.2f}</span><span class="ss">, Bits: </span><span class="sc">{</span>fpsims[idx]<span class="sc">:.2f}</span><span class="ss">, Simulated counts: </span><span class="sc">{</span>fpsims_countsim[idx]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(ms[idx],subImgSize<span class="op">=</span>(<span class="dv">350</span>,<span class="dv">250</span>),molsPerRow<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count: 0.60, Bits: 0.29, Simulated counts: 0.42</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>delts <span class="op">=</span> <span class="bu">sorted</span>([(related_countsims[i]<span class="op">-</span>related_fpsims[i],i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(related_fpsims))])</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[:<span class="dv">5</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[(-0.26508684133058585, 4359), (-0.24506749740394607, 1322), (-0.2321428571428572, 7602), (-0.21353383458646613, 10080), (-0.20879676440849337, 3804)]
[(0.24318181818181822, 1962), (0.24456938410426782, 1961), (0.24456938410426782, 1969), (0.2455492835432045, 1963), (0.273972602739726, 7774)]</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-scrolled="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">1969</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Count: </span><span class="sc">{</span>related_countsims[idx]<span class="sc">:.2f}</span><span class="ss">, Bits: </span><span class="sc">{</span>related_fpsims[idx]<span class="sc">:.2f}</span><span class="ss">, Simulated counts: </span><span class="sc">{</span>related_fpsims_countsim[idx]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(related_ms[idx],subImgSize<span class="op">=</span>(<span class="dv">350</span>,<span class="dv">250</span>),molsPerRow<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count: 0.59, Bits: 0.35, Simulated counts: 0.52</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-18-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">4359</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Count: </span><span class="sc">{</span>related_countsims[idx]<span class="sc">:.2f}</span><span class="ss">, Bits: </span><span class="sc">{</span>related_fpsims[idx]<span class="sc">:.2f}</span><span class="ss">, Simulated counts: </span><span class="sc">{</span>related_fpsims_countsim[idx]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(related_ms[idx],subImgSize<span class="op">=</span>(<span class="dv">350</span>,<span class="dv">250</span>),molsPerRow<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count: 0.39, Bits: 0.65, Simulated counts: 0.51</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-19-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-27" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="topological-torsions" class="level2">
<h2 class="anchored" data-anchor-id="topological-torsions">Topological Torsions</h2>
<div id="cell-31" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetTopologicalTorsionGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetTopologicalTorsionGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-32" class="cell" data-scrolled="false" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetTopologicalTorsionGenerator(fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="atom-pairs" class="level2">
<h2 class="anchored" data-anchor-id="atom-pairs">Atom pairs</h2>
<div id="cell-36" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetAtomPairGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetAtomPairGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-37" class="cell" data-scrolled="false" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetAtomPairGenerator(fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rdkit-fingerprint" class="level2">
<h2 class="anchored" data-anchor-id="rdkit-fingerprint">RDKit Fingerprint</h2>
<div id="cell-41" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-scrolled="false" data-execution_count="31">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is terrible, but I suspect that has to do with the number of bits set by RDKit fingerprints just totally overloading things.</p>
<div id="cell-45" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>That’s way better</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/greglandrum\.github\.io\/rdkit-blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="greglandrum/rdkit-blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright (C) 2025 Greg Landrum</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><a href="https://www.rdkit.org"><img src="https://www.rdkit.org/logo.small.png" class="img-fluid" alt="RDKit" width="64"></a></p>
</div>
  </div>
</footer>




</body></html>