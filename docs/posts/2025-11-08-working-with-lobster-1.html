<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-11-08">
<meta name="description" content="Registering and working with a 3D data set using lwreg">

<title>Working with the LOBSTER Data set I – RDKit blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../posts/icons/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-40840319e1d09552a0f54992bf705f97.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-f86ed83de42dc3a6349cec1bcdefd5d4.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">RDKit blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">RDKit experiments, tips, and tutorials</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rdkit/rdkit"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/rdkit.bsky.social"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/8192558/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#registering-the-structures-and-populating-the-data-base" id="toc-registering-the-structures-and-populating-the-data-base" class="nav-link active" data-scroll-target="#registering-the-structures-and-populating-the-data-base">Registering the structures and populating the data base</a></li>
  <li><a href="#composition-of-the-database" id="toc-composition-of-the-database" class="nav-link" data-scroll-target="#composition-of-the-database">Composition of the database</a></li>
  <li><a href="#retrieving-info-from-the-database" id="toc-retrieving-info-from-the-database" class="nav-link" data-scroll-target="#retrieving-info-from-the-database">Retrieving info from the database</a></li>
  <li><a href="#look-at-duplicate-mismatches" id="toc-look-at-duplicate-mismatches" class="nav-link" data-scroll-target="#look-at-duplicate-mismatches">Look at duplicate mismatches</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Working with the LOBSTER Data set I</h1>
  <div class="quarto-categories">
    <div class="quarto-category">datasets</div>
    <div class="quarto-category">3d</div>
    <div class="quarto-category">lwreg</div>
  </div>
  </div>

<div>
  <div class="description">
    Registering and working with a 3D data set using lwreg
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 8, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Last year the Rarey and BioSolveIT groups published <a href="https://doi.org/10.1007/s10822-024-00581-1">a paper</a> describing LOBSTER, a data set of small molecule overlays drawn from the PDB. The carefully curated and constructed data set is intended to be a new benchmarking set for testing molecular alignment (superposition) tools. I’m really happy to have an up-to-date replacement for the older <a href="https://doi.org/10.1021/ci400020a">“AZ set”</a>, which is what I’ve previously always used when looking at alignment. The well-written paper (as one expects from the Rarey group!) is definitely worth reading in order to understand the decisions made in the curation workflow. The code used for the curation is available in GitHub and the data set itself can be downloaded from Zenodo. There are links in the (open access) paper to both places.</p>
<p>I have a number of ideas for experiments to do using the LOBSTER set, so I wanted to get it loaded up into a database I could use for those experiments. This blog post demonstrates how I did that.</p>
<p>I’m using our <a href="https://pubs.acs.org/doi/full/10.1021/acs.jcim.4c01133">lwreg</a> tool to handle registering the compound structures and to provide the basic schema for the database. You can <code>pip install</code> it from our <a href="https://github.com/rinikerlab/lightweight-registration">github repo</a> I’ve blogged about <a href="https://greglandrum.github.io/rdkit-blog/posts/2024-10-31-lwreg-and-the-cartridge.html">using lwreg together with the RDKit PostgreSQL cartridge</a> before.</p>
<div id="209d81ae" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> Draw</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>IPythonConsole.ipython_3d <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext sql</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config SqlMagic.feedback<span class="op">=</span><span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The sql extension is already loaded. To reload it, use:
  %reload_ext sql</code></pre>
</div>
</div>
<section id="registering-the-structures-and-populating-the-data-base" class="level1">
<h1>Registering the structures and populating the data base</h1>
<div id="dc28d683" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> lwreg</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lwreg <span class="im">import</span> utils</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the command line I created the postgres database:</p>
<pre><code>% createdb lobster_112024</code></pre>
<div id="e184d2ce" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> utils.defaultConfig()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>config</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>{'dbname': './testdb.sqlt',
 'dbtype': 'sqlite3',
 'standardization': 'fragment',
 'removeHs': 1,
 'useTautomerHashv2': 0,
 'registerConformers': 0,
 'numConformerDigits': 3,
 'lwregSchema': '',
 'cacheConnection': True}</code></pre>
</div>
</div>
<p>Configure lwreg to work with the database I created. We’ll turn off standardization and switch in to “registerConformers” mode.</p>
<div id="ef4d901f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>config[<span class="st">'dbtype'</span>] <span class="op">=</span> <span class="st">'postgresql'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>config[<span class="st">'dbname'</span>] <span class="op">=</span> <span class="st">'lobster_112024'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>config[<span class="st">'standardization'</span>] <span class="op">=</span> <span class="st">'none'</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>config[<span class="st">'registerConformers'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>lwreg.set_default_config(config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6257a1dd" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lwreg.initdb()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This will destroy any existing information in the registration database.
  are you sure? [yes/no]: yes</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>True</code></pre>
</div>
</div>
<p>I downloaded the LOBSTER data from zenodo and extracted the zipfile locally.</p>
<p>Read in the SDFs containing the ligand structures and registering each 3D structure in lwreg:</p>
<div id="c6220795" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sdfs <span class="op">=</span> glob.glob(<span class="st">'/scratch/Data/LOBSTER_112024/all_ligands/*.sdf'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>registered <span class="op">=</span> []</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sdf <span class="kw">in</span> sdfs:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    ms <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> Chem.SDMolSupplier(sdf,removeHs<span class="op">=</span><span class="va">False</span>) <span class="cf">if</span> x <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">len</span>(ms)<span class="op">==</span><span class="dv">1</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> ms[<span class="dv">0</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    ligname <span class="op">=</span> m.GetProp(<span class="st">'_Name'</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    ligpdb <span class="op">=</span> m.GetProp(<span class="st">'pdb_id'</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    naomi_smis <span class="op">=</span> m.GetProp(<span class="st">'usmiles'</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    mrn,confid <span class="op">=</span> lwreg.register(mol<span class="op">=</span>m)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    registered.append(((mrn,confid),ligname,ligpdb,naomi_smis,sdf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s store the additional information from the LOBSTER data set in a separate table in the database:</p>
<div id="97af31fd" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cn <span class="op">=</span> utils.<span class="ex">connect</span>(config<span class="op">=</span>config) <span class="co">#&lt; lwreg provides a convenience function to get a database connection</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>curs <span class="op">=</span> cn.cursor()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>curs.execute(<span class="st">'create schema lobster_data'</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>curs.execute(<span class="st">'''create table lobster_data.all_ligands</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">   (molregno integer references hashes, </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">    conf_id integer references conformers,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="st">    ligname text, pdb text, naomi_smiles text, filename text)'''</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> [(x[<span class="dv">0</span>][<span class="dv">0</span>],x[<span class="dv">0</span>][<span class="dv">1</span>],x[<span class="dv">1</span>],x[<span class="dv">2</span>],x[<span class="dv">3</span>],x[<span class="dv">4</span>]) <span class="cf">for</span> x <span class="kw">in</span> registered]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>curs.executemany(<span class="st">'insert into lobster_data.all_ligands values (</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">)'</span>,rows)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>cn.commit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c005775f" class="cell" data-scrolled="true" data-execution_count="61">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    select count(<span class="op">*</span>) <span class="im">from</span> lobster_data.all_ligands<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 rows affected.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="61">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3583</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Install the RDKit catridge, load the molecules, and create an index on the molecule column so that we can do efficient substructure searching. More information about that in <a href="https://greglandrum.github.io/rdkit-blog/posts/2024-10-31-lwreg-and-the-cartridge.html">this blog post</a></p>
<div id="e12e9ba8" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  create extension <span class="cf">if</span> <span class="kw">not</span> exists rdkit<span class="op">;</span> <span class="op">\</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    create schema <span class="cf">if</span> <span class="kw">not</span> exists rdk<span class="op">;</span> <span class="op">\</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    drop table <span class="cf">if</span> exists rdk.mols cascade<span class="op">;\</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    select molregno,mol_from_ctab(molblock::cstring,false) m into rdk.mols <span class="im">from</span> molblocks<span class="op">;\</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    create index molidx on rdk.mols using gist(m)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>[]</code></pre>
</div>
</div>
<p>Let’s add some fingerprints so that we can do similarity searches later. We’ll add both bit- and count-based Morgan fingerprints with radius 3:</p>
<div id="e815c231" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    drop table <span class="cf">if</span> exists rdk.fps<span class="op">;\</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  select molregno,morganbv_fp(m,<span class="dv">3</span>) <span class="im">as</span> mfp3, morgan_fp(m,<span class="dv">3</span>) cfp3 into rdk.fps <span class="im">from</span> rdk.mols<span class="op">;\</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    create index fps_mfp3_idx on rdk.fps using gist(mfp3)<span class="op">;</span> <span class="op">\</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    create index fps_cfp3_idx on rdk.fps using gist(cfp3)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>[]</code></pre>
</div>
</div>
<p>And now add some descriptors we might want to use:</p>
<div id="0f7166fa" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    drop table <span class="cf">if</span> exists rdk.descriptors<span class="op">;\</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  select molregno,mol_numheavyatoms(m) nhvy, mol_amw(m) amw, mol_numrotatablebonds(m) nrot into rdk.descriptors <span class="im">from</span> rdk.mols<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>[]</code></pre>
</div>
</div>
<p>Add a column with nTABS, a measure of molecular flexibility developed by Jessica Braun in our lab (Jessica is also the other author/developer of lwreg). There’s <a href="https://pubs.acs.org/doi/10.1021/acs.jcim.4c01513">a paper</a> and a <a href="https://github.com/rinikerlab/TorsionAngularBinStrings">github repo</a> from which you can install the code.</p>
<div id="ee0ec1c9" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tabs</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tqdm</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  select molregno,molblock <span class="im">from</span> molblocks</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ntabs <span class="op">=</span> []</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mrn,mb <span class="kw">in</span> tqdm.tqdm(d):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> Chem.MolFromMolBlock(mb,removeHs<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    nt <span class="op">=</span> tabs.GetnTABS(m)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    ntabs.append((mrn,nt))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 3218/3218 [00:13&lt;00:00, 245.40it/s]</code></pre>
</div>
</div>
<p>Add the nTABS values to the database:</p>
<div id="69a2b6a2" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cn <span class="op">=</span> utils.<span class="ex">connect</span>(config<span class="op">=</span>config)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>curs <span class="op">=</span> cn.cursor()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>intabs <span class="op">=</span> [(y,x) <span class="cf">for</span> x,y <span class="kw">in</span> ntabs]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>curs.execute(<span class="st">'alter table rdk.descriptors add column ntabs int'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>curs.executemany(<span class="st">'update rdk.descriptors set ntabs=</span><span class="sc">%s</span><span class="st"> where molregno=</span><span class="sc">%s</span><span class="st">'</span>,intabs)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>cn.commit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load data about pairs of aligned ligands from the LOBSTER data:</p>
<div id="fd406172" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ind <span class="op">=</span> [x.strip().split(<span class="st">';'</span>) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">open</span>(<span class="st">'/scratch/Data/LOBSTER_112024/stats/pair_stats.csv'</span>,<span class="st">'r'</span>)]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>72593</code></pre>
</div>
</div>
<div id="41003d68" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ind.pop(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>['query_file',
 'query',
 'pdb',
 'template_file',
 'template',
 'template_pdb',
 'ensemble',
 'morgan_fp_tanimoto',
 'gobbi_2D_pharmacophore_fp_tanimoto',
 'hac_difference',
 'shape_tversky_index',
 'shape_tanimoto_distance',
 'shape_protrude_distance',
 '']</code></pre>
</div>
</div>
<p>And add that to the database too:</p>
<div id="f5ba4bd9" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cn <span class="op">=</span> utils.<span class="ex">connect</span>(config<span class="op">=</span>config)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>curs <span class="op">=</span> cn.cursor()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>curs.execute(<span class="st">'''create table lobster_data.pair_stats</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="st">   (ligname1 text, pdb1 text, ligname2 text, pdb2 text, ensemble text,</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="st">    morgan_fp_tanimoto float, gobbi_2D_pharmacophore_fp_tanimoto float,</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="st">    hac_difference int, shape_tversky_index float, shape_tanimoto_distance float,</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="st">    shape_protrude_distance float)'''</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> [(x[<span class="dv">1</span>],x[<span class="dv">2</span>],x[<span class="dv">4</span>],x[<span class="dv">5</span>],x[<span class="dv">6</span>],<span class="bu">float</span>(x[<span class="dv">7</span>]),<span class="bu">float</span>(x[<span class="dv">8</span>]),<span class="bu">int</span>(<span class="bu">float</span>(x[<span class="dv">9</span>])),<span class="bu">float</span>(x[<span class="dv">10</span>]),<span class="op">\</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>         <span class="bu">float</span>(x[<span class="dv">11</span>]),<span class="bu">float</span>(x[<span class="dv">12</span>]),) <span class="cf">for</span> x <span class="kw">in</span> ind]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>curs.executemany(<span class="st">'insert into lobster_data.pair_stats values (</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%s</span><span class="st">)'</span>,rows)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>cn.commit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="composition-of-the-database" class="level1">
<h1>Composition of the database</h1>
<p>Now let’s look at what we’ve got:</p>
<div id="026bb964" class="cell" data-scrolled="true" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(registered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>3583</code></pre>
</div>
</div>
<p>Number of unique molregnos:</p>
<div id="28697517" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  select count(<span class="op">*</span>) <span class="im">from</span> hashes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3218</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Number of conformers (this is the number we registered):</p>
<div id="12006a66" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  select count(<span class="op">*</span>) <span class="im">from</span> conformers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3583</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Number of pairs of aligned molecules:</p>
<div id="789394cf" class="cell" data-scrolled="true" data-execution_count="125">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  select count(<span class="op">*</span>) <span class="im">from</span> lobster_data.pair_stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>72592</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Number of unique naomi_smiles:</p>
<div id="577bd08f" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  select count(distinct naomi_smiles) <span class="im">from</span> lobster_data.all_ligands</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3212</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We’ll look at the mismatch between the number of naomi_smiles and the number of molecule hashes below</p>
</section>
<section id="retrieving-info-from-the-database" class="level1">
<h1>Retrieving info from the database</h1>
<p>Get all of the molecule hashes for one particular molregno using lwreg functions:</p>
<div id="1795724e" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lwreg.retrieve(<span class="bu">id</span><span class="op">=</span><span class="dv">12</span>,as_hashes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>{12: {'fullhash': '6d22ca45dd6fb8f29d263532db4f913e7da47d6a',
  'formula': 'C18H16N6',
  'canonical_smiles': 'CN(c1cnc2nc(N)nc(N)c2c1)c1cccc2ccccc12',
  'no_stereo_smiles': 'CN(c1cnc2nc(N)nc(N)c2c1)c1cccc2ccccc12',
  'tautomer_hash': 'CN([C]1[CH][N][C]2[N][C]([N])[N][C]([N])[C]2[CH]1)[C]1[CH][CH][CH][C]2[CH][CH][CH][CH][C]21_4_0',
  'no_stereo_tautomer_hash': 'CN([C]1[CH][N][C]2[N][C]([N])[N][C]([N])[C]2[CH]1)[C]1[CH][CH][CH][C]2[CH][CH][CH][CH][C]21_4_0',
  'escape': '',
  'sgroup_data': '[]'}}</code></pre>
</div>
</div>
<p>We can see here that the Hs have been removed by lwreg when calculating the hashes used for comparing 2D molecules to each other.</p>
<p>The molecules stored in the database still have their Hs. We can see this by retrieving the registered mol block for the molecule:</p>
<div id="c8a2c152" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> Chem.MolFromMolBlock(lwreg.retrieve(<span class="bu">id</span><span class="op">=</span><span class="dv">12</span>)[<span class="dv">12</span>][<span class="dv">0</span>],removeHs<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_17625757959049916" style="position: relative; width: 400px; height: 400px;">
        <p id="3dmolwarning_17625757959049916" style="background-color:#ffcccc;color:black">3Dmol.js failed to load for some reason.  Please check your browser console for error messages.<br></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.4.0/3Dmol-min.js');
}

var viewer_17625757959049916 = null;
var warn = document.getElementById("3dmolwarning_17625757959049916");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_17625757959049916 = $3Dmol.createViewer(document.getElementById("3dmolviewer_17625757959049916"),{backgroundColor:"white"});
viewer_17625757959049916.zoomTo();
    viewer_17625757959049916.removeAllModels();
    viewer_17625757959049916.addModel("33M_D_301\n     RDKit          3D\n\n 40 43  0  0  0  0  0  0  0  0999 V2000\n    9.7259   -3.2696   11.6873 N   0  0  0  0  0  0  0  0  0  0  0  0\n   10.4981    0.3535   14.5814 N   0  0  0  0  0  0  0  0  0  0  0  0\n   13.4437   -0.6379   10.9108 N   0  0  0  0  0  0  0  0  0  0  0  0\n   10.0654   -1.4201   13.1743 N   0  0  0  0  0  0  0  0  0  0  0  0\n   11.5849   -1.9173   11.4370 N   0  0  0  0  0  0  0  0  0  0  0  0\n   14.8172    2.3874   12.4647 N   0  0  0  0  0  0  0  0  0  0  0  0\n   14.5309    3.3039   13.6379 C   0  0  0  0  0  0  0  0  0  0  0  0\n   14.2607    0.4413   11.2177 C   0  0  0  0  0  0  0  0  0  0  0  0\n   15.2482    4.2831    7.7614 C   0  0  0  0  0  0  0  0  0  0  0  0\n   14.1349    4.0651    8.6112 C   0  0  0  0  0  0  0  0  0  0  0  0\n   18.3005    2.5330   11.1357 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.2061    2.3421   12.0385 C   0  0  0  0  0  0  0  0  0  0  0  0\n   16.5568    3.9787    8.1964 C   0  0  0  0  0  0  0  0  0  0  0  0\n   18.0993    3.1132    9.8675 C   0  0  0  0  0  0  0  0  0  0  0  0\n   14.3683    3.5412    9.8793 C   0  0  0  0  0  0  0  0  0  0  0  0\n   12.8406    1.0733   13.0796 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.4450   -2.2057   12.1256 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.8450   -0.3774   13.5337 C   0  0  0  0  0  0  0  0  0  0  0  0\n   12.3603   -0.8452   11.7042 C   0  0  0  0  0  0  0  0  0  0  0  0\n   13.9843    1.3211   12.2560 C   0  0  0  0  0  0  0  0  0  0  0  0\n   15.8990    2.6320   11.6222 C   0  0  0  0  0  0  0  0  0  0  0  0\n   16.7856    3.4355    9.4819 C   0  0  0  0  0  0  0  0  0  0  0  0\n   12.0162   -0.0199   12.7773 C   0  0  0  0  0  0  0  0  0  0  0  0\n   15.6745    3.1891   10.3410 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.0542   -3.8100   10.9126 H   0  0  0  0  0  0  0  0  0  0  0  0\n    8.8677   -3.5133   12.1390 H   0  0  0  0  0  0  0  0  0  0  0  0\n   11.0651    1.1287   14.8600 H   0  0  0  0  0  0  0  0  0  0  0  0\n    9.6692    0.1305   15.0943 H   0  0  0  0  0  0  0  0  0  0  0  0\n   15.2152    4.0326   13.6663 H   0  0  0  0  0  0  0  0  0  0  0  0\n   13.6209    3.7051   13.5331 H   0  0  0  0  0  0  0  0  0  0  0  0\n   14.5678    2.7786   14.4880 H   0  0  0  0  0  0  0  0  0  0  0  0\n   15.0826    0.5916   10.6682 H   0  0  0  0  0  0  0  0  0  0  0  0\n   15.1056    4.6563    6.8447 H   0  0  0  0  0  0  0  0  0  0  0  0\n   13.2070    4.2817    8.3078 H   0  0  0  0  0  0  0  0  0  0  0  0\n   19.2201    2.2507   11.4088 H   0  0  0  0  0  0  0  0  0  0  0  0\n   17.3735    2.0028   12.9641 H   0  0  0  0  0  0  0  0  0  0  0  0\n   17.3315    4.1495    7.5876 H   0  0  0  0  0  0  0  0  0  0  0  0\n   18.8710    3.2914    9.2570 H   0  0  0  0  0  0  0  0  0  0  0  0\n   13.5903    3.4055   10.4927 H   0  0  0  0  0  0  0  0  0  0  0  0\n   12.6333    1.6684   13.8560 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1 17  1  0\n  2 18  1  0\n  3  8  2  0\n  3 19  1  0\n  4 17  2  0\n  4 18  1  0\n  5 17  1  0\n  5 19  2  0\n  6  7  1  0\n  6 20  1  0\n  6 21  1  0\n  8 20  1  0\n  9 10  2  0\n  9 13  1  0\n 10 15  1  0\n 11 12  1  0\n 11 14  2  0\n 12 21  2  0\n 13 22  2  0\n 14 22  1  0\n 15 24  2  0\n 16 20  2  0\n 16 23  1  0\n 18 23  2  0\n 19 23  1  0\n 21 24  1  0\n 22 24  1  0\n  1 25  1  0\n  1 26  1  0\n  2 27  1  0\n  2 28  1  0\n  7 29  1  0\n  7 30  1  0\n  7 31  1  0\n  8 32  1  0\n  9 33  1  0\n 10 34  1  0\n 11 35  1  0\n 12 36  1  0\n 13 37  1  0\n 14 38  1  0\n 15 39  1  0\n 16 40  1  0\nM  END\n","sdf");
    viewer_17625757959049916.setStyle({"stick": {}});
    viewer_17625757959049916.setBackgroundColor("0xeeeeee");
    viewer_17625757959049916.zoomTo();
viewer_17625757959049916.render();
});
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="48">

</div>
</div>
<p>Ligands that appear multiple times in the data set will have the same molregno but different confids. Let’s find those:</p>
<div id="b5873f43" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>repeated_ligands <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tpl <span class="kw">in</span> registered:</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    mrn,cid <span class="op">=</span> tpl[<span class="dv">0</span>]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mrn <span class="kw">in</span> seen:</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        repeated_ligands[mrn].append(cid)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    seen.add(mrn)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(repeated_ligands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>219</code></pre>
</div>
</div>
<p>Get the molregnos for the molecules that have more than two conformers present:</p>
<div id="4956cc46" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>[k <span class="cf">for</span> k,v <span class="kw">in</span> repeated_ligands.items() <span class="cf">if</span> <span class="bu">len</span>(v)<span class="op">&gt;</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>[84,
 180,
 110,
 77,
 68,
 92,
 78,
 503,
 583,
 53,
 384,
 568,
 296,
 565,
 281,
 228,
 715,
 1016,
 1335,
 1123,
 795,
 454,
 936,
 1029,
 1317,
 267,
 1601]</code></pre>
</div>
</div>
<p>Each entry in the <code>repeated_ligands</code> dictionary includes the conf_ids of the conformers:</p>
<div id="932a5ea3" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>repeated_ligands[<span class="dv">84</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>[207, 215, 802, 968, 2150]</code></pre>
</div>
</div>
<p>We can get the conformers themselves by calling <code>lwreg.retrieve()</code> with a list of (molregno,conf_id) tuples:</p>
<div id="997c6b8e" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">84</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>confs <span class="op">=</span> lwreg.retrieve(ids<span class="op">=</span>[(k,x) <span class="cf">for</span> x <span class="kw">in</span> repeated_ligands[k]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="98de086c" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>confs[(<span class="dv">84</span>,<span class="dv">207</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>('AZM_E_303\n     RDKit          3D\n\n  0  0  0  0  0  0  0  0  0  0999 V3000\nM  V30 BEGIN CTAB\nM  V30 COUNTS 19 19 0 0 0\nM  V30 BEGIN ATOM\nM  V30 1 S 9.311200 -40.854300 -76.602200 0\nM  V30 2 S 10.494600 -38.554800 -74.957200 0\nM  V30 3 O 9.730100 -37.268900 -74.826900 0\nM  V30 4 O 10.160500 -39.565300 -73.911800 0\nM  V30 5 O 8.149900 -43.309900 -77.530300 0\nM  V30 6 N 12.092600 -38.206500 -74.914100 0\nM  V30 7 N 10.151000 -38.844000 -77.734300 0\nM  V30 8 N 9.709100 -39.647400 -78.701300 0\nM  V30 9 N 8.662000 -41.847200 -79.186200 0\nM  V30 10 C 7.602600 -44.129200 -79.665200 0\nM  V30 11 C 10.029000 -39.323500 -76.470700 0\nM  V30 12 C 9.187000 -40.841600 -78.320400 0\nM  V30 13 C 8.151000 -43.081400 -78.698500 0\nM  V30 14 H 12.620400 -39.051600 -74.999600 0\nM  V30 15 H 12.320600 -37.593200 -75.670300 0\nM  V30 16 H 8.653100 -41.677800 -80.171700 0\nM  V30 17 H 7.673700 -43.787600 -80.602400 0\nM  V30 18 H 8.131400 -44.973300 -79.577000 0\nM  V30 19 H 6.643600 -44.312500 -79.449200 0\nM  V30 END ATOM\nM  V30 BEGIN BOND\nM  V30 1 1 1 11\nM  V30 2 1 1 12\nM  V30 3 2 2 3\nM  V30 4 2 2 4\nM  V30 5 1 2 6\nM  V30 6 1 2 11\nM  V30 7 2 5 13\nM  V30 8 1 7 8\nM  V30 9 2 7 11\nM  V30 10 2 8 12\nM  V30 11 1 9 12\nM  V30 12 1 9 13\nM  V30 13 1 10 13\nM  V30 14 1 6 14\nM  V30 15 1 6 15\nM  V30 16 1 9 16\nM  V30 17 1 10 17\nM  V30 18 1 10 18\nM  V30 19 1 10 19\nM  V30 END BOND\nM  V30 END CTAB\nM  END\n',
 'mol')</code></pre>
</div>
</div>
<p>Convert all of those mol blocks into RDKit molecules:</p>
<div id="5a7d19e1" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>conf_mols <span class="op">=</span> [Chem.MolFromMolBlock(confs[x][<span class="dv">0</span>],removeHs<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> x <span class="kw">in</span> confs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And look at the first couple:</p>
<div id="9dcf04f8" class="cell" data-scrolled="true" data-execution_count="51">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>conf_mols[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_17625759327529206" style="position: relative; width: 400px; height: 400px;">
        <p id="3dmolwarning_17625759327529206" style="background-color:#ffcccc;color:black">3Dmol.js failed to load for some reason.  Please check your browser console for error messages.<br></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.4.0/3Dmol-min.js');
}

var viewer_17625759327529206 = null;
var warn = document.getElementById("3dmolwarning_17625759327529206");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_17625759327529206 = $3Dmol.createViewer(document.getElementById("3dmolviewer_17625759327529206"),{backgroundColor:"white"});
viewer_17625759327529206.zoomTo();
    viewer_17625759327529206.removeAllModels();
    viewer_17625759327529206.addModel("AZM_E_303\n     RDKit          3D\n\n 19 19  0  0  0  0  0  0  0  0999 V2000\n    9.3112  -40.8543  -76.6022 S   0  0  0  0  0  0  0  0  0  0  0  0\n   10.4946  -38.5548  -74.9572 S   0  0  0  0  0  0  0  0  0  0  0  0\n    9.7301  -37.2689  -74.8269 O   0  0  0  0  0  0  0  0  0  0  0  0\n   10.1605  -39.5653  -73.9118 O   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1499  -43.3099  -77.5303 O   0  0  0  0  0  0  0  0  0  0  0  0\n   12.0926  -38.2065  -74.9141 N   0  0  0  0  0  0  0  0  0  0  0  0\n   10.1510  -38.8440  -77.7343 N   0  0  0  0  0  0  0  0  0  0  0  0\n    9.7091  -39.6474  -78.7013 N   0  0  0  0  0  0  0  0  0  0  0  0\n    8.6620  -41.8472  -79.1862 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.6026  -44.1292  -79.6652 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.0290  -39.3235  -76.4707 C   0  0  0  0  0  0  0  0  0  0  0  0\n    9.1870  -40.8416  -78.3204 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1510  -43.0814  -78.6985 C   0  0  0  0  0  0  0  0  0  0  0  0\n   12.6204  -39.0516  -74.9996 H   0  0  0  0  0  0  0  0  0  0  0  0\n   12.3206  -37.5932  -75.6703 H   0  0  0  0  0  0  0  0  0  0  0  0\n    8.6531  -41.6778  -80.1717 H   0  0  0  0  0  0  0  0  0  0  0  0\n    7.6737  -43.7876  -80.6024 H   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1314  -44.9733  -79.5770 H   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6436  -44.3125  -79.4492 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1 11  1  0\n  1 12  1  0\n  2  3  2  0\n  2  4  2  0\n  2  6  1  0\n  2 11  1  0\n  5 13  2  0\n  7  8  1  0\n  7 11  2  0\n  8 12  2  0\n  9 12  1  0\n  9 13  1  0\n 10 13  1  0\n  6 14  1  0\n  6 15  1  0\n  9 16  1  0\n 10 17  1  0\n 10 18  1  0\n 10 19  1  0\nM  END\n","sdf");
    viewer_17625759327529206.setStyle({"stick": {}});
    viewer_17625759327529206.setBackgroundColor("0xeeeeee");
    viewer_17625759327529206.zoomTo();
viewer_17625759327529206.render();
});
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">

</div>
</div>
<div id="bd90af6d" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>conf_mols[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_17625759407695315" style="position: relative; width: 400px; height: 400px;">
        <p id="3dmolwarning_17625759407695315" style="background-color:#ffcccc;color:black">3Dmol.js failed to load for some reason.  Please check your browser console for error messages.<br></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.4.0/3Dmol-min.js');
}

var viewer_17625759407695315 = null;
var warn = document.getElementById("3dmolwarning_17625759407695315");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_17625759407695315 = $3Dmol.createViewer(document.getElementById("3dmolviewer_17625759407695315"),{backgroundColor:"white"});
viewer_17625759407695315.zoomTo();
    viewer_17625759407695315.removeAllModels();
    viewer_17625759407695315.addModel("AZM_A_262\n     RDKit          3D\n\n 19 19  0  0  0  0  0  0  0  0999 V2000\n    1.6042   70.8027   56.8891 S   0  0  0  0  0  0  0  0  0  0  0  0\n    3.2937   72.4472   58.7703 S   0  0  0  0  0  0  0  0  0  0  0  0\n    3.3750   71.0598   59.2463 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6993   73.3963   59.6063 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1118   69.2710   56.3052 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7494   72.8722   58.3430 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.3388   73.1756   56.3776 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.7295   72.7252   55.2524 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.2324   70.8034   54.6557 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.1568   68.8399   54.2799 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.3965   72.2531   57.2632 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2369   71.4841   55.3669 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.3062   69.6543   55.1481 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7374   73.8154   58.0111 H   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3614   72.8037   59.1309 H   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0888   71.1666   53.7811 H   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2236   69.2703   53.3798 H   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.7590   67.9274   54.1844 H   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0693   68.7653   54.6822 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1 11  1  0\n  1 12  1  0\n  2  3  2  0\n  2  4  2  0\n  2  6  1  0\n  2 11  1  0\n  5 13  2  0\n  7  8  1  0\n  7 11  2  0\n  8 12  2  0\n  9 12  1  0\n  9 13  1  0\n 10 13  1  0\n  6 14  1  0\n  6 15  1  0\n  9 16  1  0\n 10 17  1  0\n 10 18  1  0\n 10 19  1  0\nM  END\n","sdf");
    viewer_17625759407695315.setStyle({"stick": {}});
    viewer_17625759407695315.setBackgroundColor("0xeeeeee");
    viewer_17625759407695315.zoomTo();
viewer_17625759407695315.render();
});
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">

</div>
</div>
<p>Let’s get all the pairs of conformers that have a shape Tversky score of between 0.8 and 0.9:</p>
<div id="3004fe51" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="op">%</span>sql select ligname1,pdb1,ligname2,pdb2 <span class="im">from</span> lobster_data.pair_stats <span class="op">\</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  where shape_tversky_index<span class="op">&lt;=</span><span class="fl">0.9</span> <span class="kw">and</span> shape_tversky_index<span class="op">&gt;</span><span class="fl">0.8</span><span class="op">;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>d[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * postgresql://localhost/lobster_112024</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>[('03V_A_2002', '3u3k', 'NPO_A_300', '3u3r'),
 ('NPO_A_300', '3u3r', '03V_A_2002', '3u3k'),
 ('052_A_809', '4zeg', 'O23_A_901', '3wzk'),
 ('HS4_A_0', '3f17', 'KLG_A_0', '3rts'),
 ('NGH_A_306', '5lab', 'HS3_A_0', '3f16')]</code></pre>
</div>
</div>
<div id="08d3f61f" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>accum <span class="op">=</span> []</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ln1,pdb1,ln2,pdb2 <span class="kw">in</span> d[:<span class="dv">10</span>]:</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> <span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024<span class="op">\</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>        select molregno,conf_id <span class="im">from</span> lobster_data.all_ligands where <span class="op">\</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>      ligname<span class="op">=</span>:ln1 <span class="kw">and</span> upper(pdb)<span class="op">=</span>upper(:pdb1)<span class="op">;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> <span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024<span class="op">\</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        select molregno,conf_id <span class="im">from</span> lobster_data.all_ligands where <span class="op">\</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>      ligname<span class="op">=</span>:ln2 <span class="kw">and</span> upper(pdb)<span class="op">=</span>upper(:pdb2)<span class="op">;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    accum.append((<span class="bu">tuple</span>(d1[<span class="dv">0</span>]),<span class="bu">tuple</span>(d2[<span class="dv">0</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look at a couple of pairs:</p>
<div id="6d744b8b" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>confs <span class="op">=</span> lwreg.retrieve(ids<span class="op">=</span>accum[<span class="dv">0</span>])</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>mols <span class="op">=</span> [Chem.MolFromMolBlock(v[<span class="dv">0</span>],removeHs<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> v <span class="kw">in</span> confs.values()]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>IPythonConsole.drawMols3D(mols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_1762590943943505" style="position: relative; width: 400px; height: 400px;">
        <p id="3dmolwarning_1762590943943505" style="background-color:#ffcccc;color:black">3Dmol.js failed to load for some reason.  Please check your browser console for error messages.<br></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.4.0/3Dmol-min.js');
}

var viewer_1762590943943505 = null;
var warn = document.getElementById("3dmolwarning_1762590943943505");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_1762590943943505 = $3Dmol.createViewer(document.getElementById("3dmolviewer_1762590943943505"),{backgroundColor:"white"});
viewer_1762590943943505.zoomTo();
    viewer_1762590943943505.addModel("NPO_A_300\n     RDKit          3D\n\n 15 15  0  0  0  0  0  0  0  0999 V2000\n   21.0209   -9.4413   -8.6788 O   0  0  0  0  0  0  0  0  0  0  0  0\n   19.1617  -10.3654   -8.1724 O   0  0  0  0  0  0  0  0  0  0  0  0\n   17.3203   -4.2462   -8.3844 O   0  0  0  0  0  0  0  0  0  0  0  0\n   19.7773   -9.3329   -8.4209 N   0  0  0  0  0  0  0  0  0  0  0  0\n   17.2130   -6.5832   -7.9112 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.2987   -5.6143   -8.7848 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.8074   -7.8731   -8.0839 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.9162   -6.8961   -8.8336 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.9756   -5.4596   -8.2752 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.1712   -8.0164   -8.4316 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.8291   -3.4245   -8.6412 H   0  0  0  0  0  0  0  0  0  0  0  0\n   16.2878   -6.4843   -7.5447 H   0  0  0  0  0  0  0  0  0  0  0  0\n   19.7988   -4.8125   -9.1120 H   0  0  0  0  0  0  0  0  0  0  0  0\n   17.2467   -8.6912   -7.9560 H   0  0  0  0  0  0  0  0  0  0  0  0\n   20.8603   -6.9965   -9.1474 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1  4  1  0\n  2  4  2  0\n  3  9  1  0\n  4 10  1  0\n  5  7  2  0\n  5  9  1  0\n  6  8  1  0\n  6  9  2  0\n  7 10  1  0\n  8 10  2  0\n  3 11  1  0\n  5 12  1  0\n  6 13  1  0\n  7 14  1  0\n  8 15  1  0\nM  CHG  2   1  -1   4   1\nM  END\n","sdf");
    viewer_1762590943943505.setStyle({"stick": {}});
    viewer_1762590943943505.addModel("03V_A_2002\n     RDKit          3D\n\n 19 20  0  0  0  0  0  0  0  0999 V2000\n   17.5350   -4.1210   -8.5300 O   0  0  0  0  0  0  0  0  0  0  0  0\n   19.7620  -10.0480   -8.3760 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.7300   -9.2250   -8.9320 C   0  0  0  0  0  0  0  0  0  0  0  0\n   18.5460   -9.5000   -7.9700 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.5370   -7.8440   -9.0980 C   0  0  0  0  0  0  0  0  0  0  0  0\n   16.9720   -6.2430   -7.8640 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.1840   -7.6000   -7.6970 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.1320   -5.8930   -8.8520 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.9000   -5.4150   -8.4340 C   0  0  0  0  0  0  0  0  0  0  0  0\n   18.3440   -8.1490   -8.1160 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.3660   -7.2630   -8.7090 C   0  0  0  0  0  0  0  0  0  0  0  0\n   18.1600   -3.4540   -8.9355 H   0  0  0  0  0  0  0  0  0  0  0  0\n   19.9349  -11.0269   -8.2672 H   0  0  0  0  0  0  0  0  0  0  0  0\n   21.5963   -9.6295   -9.2251 H   0  0  0  0  0  0  0  0  0  0  0  0\n   17.8323  -10.0810   -7.5788 H   0  0  0  0  0  0  0  0  0  0  0  0\n   21.2605   -7.2848   -9.5027 H   0  0  0  0  0  0  0  0  0  0  0  0\n   16.1051   -5.8515   -7.5555 H   0  0  0  0  0  0  0  0  0  0  0  0\n   16.4828   -8.1702   -7.2689 H   0  0  0  0  0  0  0  0  0  0  0  0\n   19.8237   -5.2835   -9.2393 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1  9  1  0\n  2  3  2  0\n  2  4  1  0\n  3  5  1  0\n  4 10  2  0\n  5 11  2  0\n  6  7  2  0\n  6  9  1  0\n  7 10  1  0\n  8  9  2  0\n  8 11  1  0\n 10 11  1  0\n  1 12  1  0\n  2 13  1  0\n  3 14  1  0\n  4 15  1  0\n  5 16  1  0\n  6 17  1  0\n  7 18  1  0\n  8 19  1  0\nM  END\n","sdf");
    viewer_1762590943943505.setStyle({"stick": {}});
    viewer_1762590943943505.setStyle({"model": 0},{"stick": {"colorscheme": "cyanCarbon"}});
    viewer_1762590943943505.setStyle({"model": 1},{"stick": {"colorscheme": "redCarbon"}});
    viewer_1762590943943505.setBackgroundColor("0xeeeeee");
    viewer_1762590943943505.zoomTo();
viewer_1762590943943505.render();
});
</script>
</div>
</div>
<div id="dd8cbae9" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>confs <span class="op">=</span> lwreg.retrieve(ids<span class="op">=</span>accum[<span class="dv">2</span>])</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>mols <span class="op">=</span> [Chem.MolFromMolBlock(v[<span class="dv">0</span>],removeHs<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> v <span class="kw">in</span> confs.values()]</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>IPythonConsole.drawMols3D(mols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_17625909441996996" style="position: relative; width: 400px; height: 400px;">
        <p id="3dmolwarning_17625909441996996" style="background-color:#ffcccc;color:black">3Dmol.js failed to load for some reason.  Please check your browser console for error messages.<br></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.4.0/3Dmol-min.js');
}

var viewer_17625909441996996 = null;
var warn = document.getElementById("3dmolwarning_17625909441996996");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_17625909441996996 = $3Dmol.createViewer(document.getElementById("3dmolviewer_17625909441996996"),{backgroundColor:"white"});
viewer_17625909441996996.zoomTo();
    viewer_17625909441996996.addModel("O23_A_901\n     RDKit          3D\n\n 47 51  0  0  0  0  0  0  0  0999 V2000\n   34.4176   35.0742   60.9436 S   0  0  0  0  0  0  0  0  0  0  0  0\n   40.0834   33.9291   72.5931 O   0  0  0  0  0  0  0  0  0  0  0  0\n   34.0852   36.4313   65.5407 N   0  0  0  0  0  0  0  0  0  0  0  0\n   33.4391   34.7497   64.0005 N   0  0  0  0  0  0  0  0  0  0  0  0\n   34.9217   32.7720   65.7440 N   0  0  0  0  0  0  0  0  0  0  0  0\n   38.5749   32.6195   73.5874 N   0  0  0  0  0  0  0  0  0  0  0  0\n   35.4384   34.4712   67.0663 N   0  0  0  0  0  0  0  0  0  0  0  0\n   35.3949   36.2455   60.1127 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.7420   36.7530   66.6826 C   0  0  0  0  0  0  0  0  0  0  0  0\n   32.7964   35.6924   63.1068 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.6691   32.2609   66.7518 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.4170   35.7755   67.4430 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.1946   37.4750   60.7514 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.3100   37.4823   61.8375 C   0  0  0  0  0  0  0  0  0  0  0  0\n   39.0840   31.2609   75.5992 C   0  0  0  0  0  0  0  0  0  0  0  0\n   40.2784   31.2576   74.6463 C   0  0  0  0  0  0  0  0  0  0  0  0\n   37.4502   32.2377   70.8839 C   0  0  0  0  0  0  0  0  0  0  0  0\n   38.3107   34.4396   70.3971 C   0  0  0  0  0  0  0  0  0  0  0  0\n   36.7258   32.2624   69.6846 C   0  0  0  0  0  0  0  0  0  0  0  0\n   37.5904   34.4523   69.1964 C   0  0  0  0  0  0  0  0  0  0  0  0\n   39.0261   33.3078   72.5314 C   0  0  0  0  0  0  0  0  0  0  0  0\n   33.7778   36.2210   62.0839 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.0802   35.1430   65.1216 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.7930   34.1082   65.9362 C   0  0  0  0  0  0  0  0  0  0  0  0\n   39.4129   32.5029   74.7733 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.9869   33.3386   67.5629 C   0  0  0  0  0  0  0  0  0  0  0  0\n   38.2421   33.3297   71.2433 C   0  0  0  0  0  0  0  0  0  0  0  0\n   36.7804   33.3721   68.8395 C   0  0  0  0  0  0  0  0  0  0  0  0\n   33.4065   33.7751   63.7793 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.6722   32.1899   73.5623 H   0  0  0  0  0  0  0  0  0  0  0  0\n   35.9885   36.0739   59.3264 H   0  0  0  0  0  0  0  0  0  0  0  0\n   34.7478   37.7039   66.9923 H   0  0  0  0  0  0  0  0  0  0  0  0\n   32.4366   36.4572   63.6412 H   0  0  0  0  0  0  0  0  0  0  0  0\n   32.0446   35.2339   62.6330 H   0  0  0  0  0  0  0  0  0  0  0  0\n   35.9357   31.3061   66.8828 H   0  0  0  0  0  0  0  0  0  0  0  0\n   35.8913   36.0497   68.2796 H   0  0  0  0  0  0  0  0  0  0  0  0\n   35.6597   38.3064   60.4474 H   0  0  0  0  0  0  0  0  0  0  0  0\n   34.0876   38.2975   62.3723 H   0  0  0  0  0  0  0  0  0  0  0  0\n   39.2326   31.2635   76.5881 H   0  0  0  0  0  0  0  0  0  0  0  0\n   38.2716   30.7183   75.3856 H   0  0  0  0  0  0  0  0  0  0  0  0\n   40.2483   30.7114   73.8092 H   0  0  0  0  0  0  0  0  0  0  0  0\n   41.2092   31.2566   75.0117 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.3998   31.4380   71.4822 H   0  0  0  0  0  0  0  0  0  0  0  0\n   38.8749   35.2257   70.6494 H   0  0  0  0  0  0  0  0  0  0  0  0\n   36.1630   31.4756   69.4311 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.6567   35.2432   68.5881 H   0  0  0  0  0  0  0  0  0  0  0  0\n   39.7726   33.3229   75.2184 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1  8  1  0\n  1 22  1  0\n  2 21  2  0\n  3  9  1  0\n  3 23  2  0\n  4 10  1  0\n  4 23  1  0\n  5 11  1  0\n  5 24  2  0\n  6 21  1  0\n  6 25  1  0\n  7 12  1  0\n  7 24  1  0\n  7 26  1  0\n  8 13  2  0\n  9 12  2  0\n 10 22  1  0\n 11 26  2  0\n 13 14  1  0\n 14 22  2  0\n 15 16  1  0\n 15 25  1  0\n 16 25  1  0\n 17 19  2  0\n 17 27  1  0\n 18 20  1  0\n 18 27  2  0\n 19 28  1  0\n 20 28  2  0\n 21 27  1  0\n 23 24  1  0\n 26 28  1  0\n  4 29  1  0\n  6 30  1  0\n  8 31  1  0\n  9 32  1  0\n 10 33  1  0\n 10 34  1  0\n 11 35  1  0\n 12 36  1  0\n 13 37  1  0\n 14 38  1  0\n 15 39  1  0\n 15 40  1  0\n 16 41  1  0\n 16 42  1  0\n 17 43  1  0\n 18 44  1  0\n 19 45  1  0\n 20 46  1  0\n 25 47  1  0\nM  END\n","sdf");
    viewer_17625909441996996.setStyle({"stick": {}});
    viewer_17625909441996996.addModel("052_A_809\n     RDKit          3D\n\n 70 75  0  0  0  0  0  0  0  0999 V2000\n   40.1840   33.4120   72.3030 O   0  0  0  0  0  0  0  0  0  0  0  0\n   32.8570   37.7140   58.4980 O   0  0  0  0  0  0  0  0  0  0  0  0\n   34.8520   37.7650   66.6390 O   0  0  0  0  0  0  0  0  0  0  0  0\n   34.6790   32.5550   65.6200 N   0  0  0  0  0  0  0  0  0  0  0  0\n   33.2290   34.3320   63.8290 N   0  0  0  0  0  0  0  0  0  0  0  0\n   35.4510   35.5900   67.1950 N   0  0  0  0  0  0  0  0  0  0  0  0\n   38.4820   32.4860   73.5300 N   0  0  0  0  0  0  0  0  0  0  0  0\n   34.6320   33.8980   65.7760 N   0  0  0  0  0  0  0  0  0  0  0  0\n   33.3330   36.4720   60.7720 N   0  0  0  0  0  0  0  0  0  0  0  0\n   38.6720   35.6260   70.8310 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.1170   38.0630   58.9880 C   0  0  0  0  0  0  0  0  0  0  0  0\n   32.5810   36.3280   58.3750 C   0  0  0  0  0  0  0  0  0  0  0  0\n   33.4770   34.7370   62.4590 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.3960   32.0420   66.6880 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.4600   37.2180   60.2260 C   0  0  0  0  0  0  0  0  0  0  0  0\n   32.6950   35.6310   59.7390 C   0  0  0  0  0  0  0  0  0  0  0  0\n   33.2040   36.1970   62.2350 C   0  0  0  0  0  0  0  0  0  0  0  0\n   36.5590   38.9290   70.2690 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.2080   38.6410   70.2070 C   0  0  0  0  0  0  0  0  0  0  0  0\n   37.3470   38.7880   69.1180 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.6460   38.2270   68.9970 C   0  0  0  0  0  0  0  0  0  0  0  0\n   36.7890   38.3780   67.9190 C   0  0  0  0  0  0  0  0  0  0  0  0\n   39.9940   31.0170   74.7160 C   0  0  0  0  0  0  0  0  0  0  0  0\n   38.8100   31.2260   75.5940 C   0  0  0  0  0  0  0  0  0  0  0  0\n   36.8180   31.9250   69.4390 C   0  0  0  0  0  0  0  0  0  0  0  0\n   37.5880   31.9260   70.6180 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.0810   36.1100   65.2730 C   0  0  0  0  0  0  0  0  0  0  0  0\n   37.3120   34.2390   69.2080 C   0  0  0  0  0  0  0  0  0  0  0  0\n   39.0210   33.0420   72.3450 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.8110   36.4590   66.3770 C   0  0  0  0  0  0  0  0  0  0  0  0\n   34.0050   34.7950   64.9490 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.4290   38.1090   67.8650 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.3490   34.2610   66.8460 C   0  0  0  0  0  0  0  0  0  0  0  0\n   39.2870   32.3600   74.6980 C   0  0  0  0  0  0  0  0  0  0  0  0\n   38.0660   34.2950   70.3760 C   0  0  0  0  0  0  0  0  0  0  0  0\n   36.7020   33.0700   68.7100 C   0  0  0  0  0  0  0  0  0  0  0  0\n   38.1930   33.1070   71.0920 C   0  0  0  0  0  0  0  0  0  0  0  0\n   35.8600   33.1160   67.4310 C   0  0  0  0  0  0  0  0  0  0  0  0\n   32.4776   33.6961   64.0052 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.5302   32.1798   73.5471 H   0  0  0  0  0  0  0  0  0  0  0  0\n   39.1787   35.4880   71.6820 H   0  0  0  0  0  0  0  0  0  0  0  0\n   39.2925   35.9683   70.1254 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.9405   36.2908   70.9827 H   0  0  0  0  0  0  0  0  0  0  0  0\n   34.1170   39.0310   59.2388 H   0  0  0  0  0  0  0  0  0  0  0  0\n   34.8031   37.9025   58.2784 H   0  0  0  0  0  0  0  0  0  0  0  0\n   33.2359   35.9175   57.7404 H   0  0  0  0  0  0  0  0  0  0  0  0\n   31.6535   36.2077   58.0210 H   0  0  0  0  0  0  0  0  0  0  0  0\n   32.8858   34.2033   61.8543 H   0  0  0  0  0  0  0  0  0  0  0  0\n   34.4344   34.5517   62.2377 H   0  0  0  0  0  0  0  0  0  0  0  0\n   35.5506   31.0742   66.8866 H   0  0  0  0  0  0  0  0  0  0  0  0\n   35.1743   36.5658   59.9723 H   0  0  0  0  0  0  0  0  0  0  0  0\n   34.8050   37.8301   60.9376 H   0  0  0  0  0  0  0  0  0  0  0  0\n   31.7759   35.3888   60.0497 H   0  0  0  0  0  0  0  0  0  0  0  0\n   33.2387   34.7993   59.6262 H   0  0  0  0  0  0  0  0  0  0  0  0\n   32.2788   36.4202   62.5419 H   0  0  0  0  0  0  0  0  0  0  0  0\n   33.8658   36.7479   62.7435 H   0  0  0  0  0  0  0  0  0  0  0  0\n   36.9705   39.2352   71.1274 H   0  0  0  0  0  0  0  0  0  0  0  0\n   34.6369   38.7285   71.0232 H   0  0  0  0  0  0  0  0  0  0  0  0\n   38.3261   38.9864   69.1637 H   0  0  0  0  0  0  0  0  0  0  0  0\n   33.6700   38.0145   68.9499 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.3584   38.2772   67.1032 H   0  0  0  0  0  0  0  0  0  0  0  0\n   39.9265   30.4081   73.9256 H   0  0  0  0  0  0  0  0  0  0  0  0\n   40.9057   30.9396   75.1195 H   0  0  0  0  0  0  0  0  0  0  0  0\n   38.9290   31.2896   76.5849 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.9498   30.7581   75.3909 H   0  0  0  0  0  0  0  0  0  0  0  0\n   36.3591   31.0888   69.1387 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.7075   31.0739   71.1276 H   0  0  0  0  0  0  0  0  0  0  0  0\n   33.6175   36.8038   64.7217 H   0  0  0  0  0  0  0  0  0  0  0  0\n   37.1951   35.0846   68.6871 H   0  0  0  0  0  0  0  0  0  0  0  0\n   39.7261   33.1654   75.0961 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1 29  2  0\n  2 11  1  0\n  2 12  1  0\n  3 30  1  0\n  3 32  1  0\n  4  8  1  0\n  4 14  2  0\n  5 13  1  0\n  5 31  1  0\n  6 30  2  0\n  6 33  1  0\n  7 29  1  0\n  7 34  1  0\n  8 31  1  0\n  8 33  1  0\n  9 15  1  0\n  9 16  1  0\n  9 17  1  0\n 10 35  1  0\n 11 15  1  0\n 12 16  1  0\n 13 17  1  0\n 14 38  1  0\n 18 19  2  0\n 18 20  1  0\n 19 21  1  0\n 20 22  2  0\n 21 32  2  0\n 22 32  1  0\n 23 24  1  0\n 23 34  1  0\n 24 34  1  0\n 25 26  2  0\n 25 36  1  0\n 26 37  1  0\n 27 30  1  0\n 27 31  2  0\n 28 35  1  0\n 28 36  2  0\n 29 37  1  0\n 33 38  2  0\n 35 37  2  0\n 36 38  1  0\n  5 39  1  0\n  7 40  1  0\n 10 41  1  0\n 10 42  1  0\n 10 43  1  0\n 11 44  1  0\n 11 45  1  0\n 12 46  1  0\n 12 47  1  0\n 13 48  1  0\n 13 49  1  0\n 14 50  1  0\n 15 51  1  0\n 15 52  1  0\n 16 53  1  0\n 16 54  1  0\n 17 55  1  0\n 17 56  1  0\n 18 57  1  0\n 19 58  1  0\n 20 59  1  0\n 21 60  1  0\n 22 61  1  0\n 23 62  1  0\n 23 63  1  0\n 24 64  1  0\n 24 65  1  0\n 25 66  1  0\n 26 67  1  0\n 27 68  1  0\n 28 69  1  0\n 34 70  1  0\nM  END\n","sdf");
    viewer_17625909441996996.setStyle({"stick": {}});
    viewer_17625909441996996.setStyle({"model": 0},{"stick": {"colorscheme": "cyanCarbon"}});
    viewer_17625909441996996.setStyle({"model": 1},{"stick": {"colorscheme": "redCarbon"}});
    viewer_17625909441996996.setBackgroundColor("0xeeeeee");
    viewer_17625909441996996.zoomTo();
viewer_17625909441996996.render();
});
</script>
</div>
</div>
</section>
<section id="look-at-duplicate-mismatches" class="level1">
<h1>Look at duplicate mismatches</h1>
<p>According to lwreg we have 3218 unique structures, while the canonical SMILES provided with the Lobster data set (generated using the Hamburg group’s Naomi package) says we have 3212. Let’s look at the mismatches</p>
<div id="6bbc59d4" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  select count(distinct molregno) <span class="im">from</span> hashes join lobster_data.all_ligands using (molregno)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3218</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="422f46a1" class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  select naomi_smiles,count(distinct molregno) cnt <span class="op">\</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>     <span class="im">from</span> hashes join lobster_data.all_ligands using (molregno)<span class="op">\</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    group by (naomi_smiles) order by cnt desc limit <span class="dv">10</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">naomi_smiles</th>
<th data-quarto-table-cell-role="th">cnt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>S=P(OP(=O)(OP(=O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O)O)(O)O</td>
<td>3</td>
</tr>
<tr class="even">
<td>P(=O)(OP(=O)(O)O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O</td>
<td>2</td>
</tr>
<tr class="odd">
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4N=C(NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
<td>2</td>
</tr>
<tr class="even">
<td>P(=O)(OP(=O)(O)O)(OCC(=O)N1[C@H](C(=O)O)CCC1)O</td>
<td>2</td>
</tr>
<tr class="odd">
<td>P(=O)(O)([C@@H](N)C)C[C@H](C(=O)N[C@H](C(=O)O)C)Cc1ccc(c2ccccc2)cc1</td>
<td>2</td>
</tr>
<tr class="even">
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4NC(=NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Brc1c2OC(=O)C(Br)=C(c2ccc1O)C</td>
<td>1</td>
</tr>
<tr class="even">
<td>BrC=1C2=NC(=O)C(C=3Nc4c(cc(cc4)C(=O)O)C3NO)=C2C=CC1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Brc1c2c(OC(=O)C=C2CP(=O)(O)O)cc(c1)C</td>
<td>1</td>
</tr>
<tr class="even">
<td>Brc1c(Br)c(Br)c2N(C(=Nc2c1Br)N(C)C)CC(=O)O</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="4f165de0" class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="op">%</span>sql postgresql:<span class="op">//</span>localhost<span class="op">/</span>lobster_112024 <span class="op">\</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  select molregno,canonical_smiles,naomi_smiles <span class="im">from</span> <span class="op">\</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>      (select naomi_smiles,count(distinct molregno) cnt <span class="op">\</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>         <span class="im">from</span> hashes join lobster_data.all_ligands using (molregno)<span class="op">\</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>         group by (naomi_smiles)) downsel join lobster_data.all_ligands using (naomi_smiles) <span class="op">\</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>          join hashes using (molregno)<span class="op">\</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    where cnt<span class="op">&gt;</span><span class="dv">1</span> order by naomi_smiles asc<span class="op">;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">molregno</th>
<th data-quarto-table-cell-role="th">canonical_smiles</th>
<th data-quarto-table-cell-role="th">naomi_smiles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>927</td>
<td>Nc1nc2c(ncn2[C@@H]2O[C@@H]3CO[P@@](=O)(O)O[C@H]3[C@H]2O)c(=O)[nH]1</td>
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4N=C(NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
</tr>
<tr class="even">
<td>1363</td>
<td>Nc1nc2c(ncn2[C@@H]2O[C@@H]3CO[P@](=O)(O)O[C@H]3[C@H]2O)c(=O)[nH]1</td>
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4N=C(NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
</tr>
<tr class="odd">
<td>1363</td>
<td>Nc1nc2c(ncn2[C@@H]2O[C@@H]3CO[P@](=O)(O)O[C@H]3[C@H]2O)c(=O)[nH]1</td>
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4N=C(NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
</tr>
<tr class="even">
<td>927</td>
<td>Nc1nc2c(ncn2[C@@H]2O[C@@H]3CO[P@@](=O)(O)O[C@H]3[C@H]2O)c(=O)[nH]1</td>
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4N=C(NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
</tr>
<tr class="odd">
<td>2226</td>
<td>Nc1nc(=O)c2ncn([C@@H]3O[C@@H]4CO[P@](=O)(O)O[C@H]4[C@H]3O)c2[nH]1</td>
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4NC(=NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
</tr>
<tr class="even">
<td>91</td>
<td>Nc1nc(=O)c2ncn([C@@H]3O[C@@H]4CO[P@@](=O)(O)O[C@H]4[C@H]3O)c2[nH]1</td>
<td>P1(=O)(O[C@@H]2[C@H](O[C@@H](N3C=4NC(=NC(=O)C4N=C3)N)[C@@H]2O)CO1)O</td>
</tr>
<tr class="odd">
<td>2558</td>
<td>C[C@H](NC(=O)[C@H](Cc1ccc(-c2ccccc2)cc1)C[P@](=O)(O)[C@H](C)N)C(=O)O</td>
<td>P(=O)(O)([C@@H](N)C)C[C@H](C(=O)N[C@H](C(=O)O)C)Cc1ccc(c2ccccc2)cc1</td>
</tr>
<tr class="even">
<td>82</td>
<td>C[C@H](NC(=O)[C@H](Cc1ccc(-c2ccccc2)cc1)C[P@@](=O)(O)[C@H](C)N)C(=O)O</td>
<td>P(=O)(O)([C@@H](N)C)C[C@H](C(=O)N[C@H](C(=O)O)C)Cc1ccc(c2ccccc2)cc1</td>
</tr>
<tr class="odd">
<td>627</td>
<td>Nc1ncnc2c1ncn2[C@@H]1O[C@H](CO[P@](=O)(O)OP(=O)(O)O)[C@@H](O)[C@H]1O</td>
<td>P(=O)(OP(=O)(O)O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O</td>
</tr>
<tr class="even">
<td>1957</td>
<td>Nc1ncnc2c1ncn2[C@@H]1O[C@H](CO[P@@](=O)(O)OP(=O)(O)O)[C@@H](O)[C@H]1O</td>
<td>P(=O)(OP(=O)(O)O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O</td>
</tr>
<tr class="odd">
<td>2256</td>
<td>O=C(O)[C@@H]1CCCN1C(=O)CO[P@@](=O)(O)OP(=O)(O)O</td>
<td>P(=O)(OP(=O)(O)O)(OCC(=O)N1[C@H](C(=O)O)CCC1)O</td>
</tr>
<tr class="even">
<td>892</td>
<td>O=C(O)[C@@H]1CCCN1C(=O)CO[P@](=O)(O)OP(=O)(O)O</td>
<td>P(=O)(OP(=O)(O)O)(OCC(=O)N1[C@H](C(=O)O)CCC1)O</td>
</tr>
<tr class="odd">
<td>2877</td>
<td>Nc1ncnc2c1ncn2[C@@H]1O[C@H](CO[P@@](=O)(O)O[P@](=O)(O)OP(O)(O)=S)[C@@H](O)[C@H]1O</td>
<td>S=P(OP(=O)(OP(=O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O)O)(O)O</td>
</tr>
<tr class="even">
<td>1559</td>
<td>Nc1ncnc2c1ncn2[C@@H]1O[C@H](CO[P@@](=O)(O)O[P@@](=O)(O)OP(O)(O)=S)[C@@H](O)[C@H]1O</td>
<td>S=P(OP(=O)(OP(=O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O)O)(O)O</td>
</tr>
<tr class="odd">
<td>1559</td>
<td>Nc1ncnc2c1ncn2[C@@H]1O[C@H](CO[P@@](=O)(O)O[P@@](=O)(O)OP(O)(O)=S)[C@@H](O)[C@H]1O</td>
<td>S=P(OP(=O)(OP(=O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O)O)(O)O</td>
</tr>
<tr class="even">
<td>2139</td>
<td>Nc1ncnc2c1ncn2[C@@H]1O[C@H](CO[P@](=O)(O)O[P@](=O)(O)OP(O)(O)=S)[C@@H](O)[C@H]1O</td>
<td>S=P(OP(=O)(OP(=O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O)O)(O)O</td>
</tr>
<tr class="odd">
<td>2877</td>
<td>Nc1ncnc2c1ncn2[C@@H]1O[C@H](CO[P@@](=O)(O)O[P@](=O)(O)OP(O)(O)=S)[C@@H](O)[C@H]1O</td>
<td>S=P(OP(=O)(OP(=O)(OC[C@H]1O[C@@H](N2c3ncnc(N)c3N=C2)[C@H](O)[C@@H]1O)O)O)(O)O</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>These are all because the RDKit recognizes chiral phosphates and the Naomi SMILES seem not to.</p>
<p>Here are the first few molecules demonstrating this:</p>
<div id="3da091e3" class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ms <span class="op">=</span> []</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> d:</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    rm <span class="op">=</span> Chem.MolFromSmiles(row[<span class="dv">1</span>])</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    nm <span class="op">=</span> Chem.MolFromSmiles(row[<span class="dv">2</span>])</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    ms.extend((rm,nm))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(ms[:<span class="dv">8</span>],molsPerRow<span class="op">=</span><span class="dv">2</span>,subImgSize<span class="op">=</span>(<span class="dv">250</span>,<span class="dv">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="148">
<div>
<figure class="figure">
<p><img src="2025-11-08-working-with-lobster-1_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I’m going to wrap this up here. I’ll come back to the LOBSTER data set and this database again in future posts.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/greglandrum\.github\.io\/rdkit-blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="greglandrum/rdkit-blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright (C) 2025 Greg Landrum</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><a href="https://www.rdkit.org"><img src="https://www.rdkit.org/logo.small.png" class="img-fluid" alt="RDKit" width="64"></a></p>
</div>
  </div>
</footer>




</body></html>