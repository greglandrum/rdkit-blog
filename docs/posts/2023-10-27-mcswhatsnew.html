<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-10-27">
<meta name="description" content="A big collection of fixes and features.">

<title>New MCS features in 2023.09.1 – RDKit blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../posts/icons/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-53e29d70f03623de13ab2376923601bc.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-49b061ee4cc441246235e07f99f67764.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">RDKit blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">RDKit experiments, tips, and tutorials</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rdkit/rdkit"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/rdkit.bsky.social"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/8192558/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#custom-python-atomcompare-and-bondcompare-classes" id="toc-custom-python-atomcompare-and-bondcompare-classes" class="nav-link active" data-scroll-target="#custom-python-atomcompare-and-bondcompare-classes">Custom Python <code>AtomCompare</code> and <code>BondCompare</code> classes</a></li>
  <li><a href="#retrieve-all-degenerate-mcss" id="toc-retrieve-all-degenerate-mcss" class="nav-link" data-scroll-target="#retrieve-all-degenerate-mcss">Retrieve all degenerate MCSs</a></li>
  <li><a href="#finalmatchchecker" id="toc-finalmatchchecker" class="nav-link" data-scroll-target="#finalmatchchecker"><code>FinalMatchChecker</code></a></li>
  <li><a href="#shouldacceptmcs" id="toc-shouldacceptmcs" class="nav-link" data-scroll-target="#shouldacceptmcs"><code>ShouldAcceptMCS</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">New MCS features in 2023.09.1</h1>
  <div class="quarto-categories">
    <div class="quarto-category">release</div>
    <div class="quarto-category">tutorial</div>
  </div>
  </div>

<div>
  <div class="description">
    A big collection of fixes and features.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 27, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This guest post by Paolo Tosco (GitHub: <span class="citation" data-cites="ptosco">@ptosco</span>), one of the RDKit core maintainers, is the fourth of a few posts covering some of the new or improved features in the 2023.09.1 RDKit release.</p>
<p>A PR of mine dealing with MCS code clean up, refactoring and fixing open bugs has been open for one year or so.<br><br> The growing sense of guilt, together with new and more exciting bugs being found by myself and others during this year, prompted me to take it up again.<br><br> Eventually, I managed to complete the PR, which fixed all outstanding MCS-related bugs at the time of PR submission.<br><br> The PR was merged with no changes.<br> <a href="https://github.com/rdkit/rdkit/pull/6646">A quick glance at the PR will tell you that this was not necessarily due to my impeccable code style.</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/178d15e4-ffdf-45e8-838f-0374c4cae9ac-1-e36fdb59-83a6-4d0a-9137-621513a7613e.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>In addition to several bug fixes, the PR introduces significant performance improvements, particularly for difficult MCS cases involving the <code>CompleteRingsOnly</code> flag, which now run in finite time rather than just hanging and slowly consuming all of the available memory as they used to.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/eb695d0c-d771-4d9e-b85a-aac872b9ec84-1-8bd21686-5140-4528-8f18-94cc03234dd9.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>Here I would like to showcase the new features introduced as part of this PR, which relate to requests I had from colleagues as well as from members of the community.</p>
<section id="custom-python-atomcompare-and-bondcompare-classes" class="level1">
<h1>Custom Python <code>AtomCompare</code> and <code>BondCompare</code> classes</h1>
<p>Actually I have already implemented this feature some time ago, but I am not sure how many users are aware of it; therefore, in the following you will find a quick refresher.</p>
<div id="e5089405-3856-4376-8f56-0f388dee2c81" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:52.563359Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:52.562780Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:52.759490Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:52.758313Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:52.563321Z&quot;}" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> rdFMCS</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole, MolsToGridImage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s assume that for some reason we would like to implement a custom MCS criterion that will ignore elements and bond orders/aromaticity in ring systems, while enforcing element and bond order consideration in non-ring portions of the molecules.<br> This is not something which is readily available among the built-in <a href="https://rdkit.org/docs/source/rdkit.Chem.rdFMCS.html#rdkit.Chem.rdFMCS.AtomCompare">AtomCompare</a> and <a href="https://rdkit.org/docs/source/rdkit.Chem.rdFMCS.html#rdkit.Chem.rdFMCS.BondCompare">BondCompare</a> options; therefore, we will need custom subclasses, respectively derived from <code>AtomCompare</code> and <code>BondCompare</code> classes.</p>
<div id="84f40b83-c8cc-4327-8f9a-f87f84e5b6c8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:52.760671Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:52.760388Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:52.767806Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:52.766853Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:52.760650Z&quot;}" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mols <span class="op">=</span> [Chem.MolFromSmiles(smi) <span class="cf">for</span> smi <span class="kw">in</span> <span class="st">"""C[C@H]1COC2=C3N1C=C(C(=O)C3=CC(=C2N4CCN(CC4)C)F)C(=O)O</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">C1[C@@H]2[C@@H](C2N)CN1C3=C(C=C4C(=O)C(=CN(C4=N3)C5=C(C=C(C=C5)F)F)C(=O)O)F</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">CN(C)CC[C@@](C1=CC=CC2=CC=CC=C21)([C@H](C3=CC=CC=C3)C4=C(N=C5C=CC(=CC5=C4)Br)OC)O</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>.split()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fef7e88b-51f6-405a-b102-d639ae71860a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:52.769008Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:52.768693Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:52.841755Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:52.840603Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:52.768974Z&quot;}" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>WIth this rather standard set of parameters, which enforces that ring bonds should only match ring bonds and that rings should be complete, the MCS is 3-methylpyridine:</p>
<div id="4d7b9afb-a032-42d5-9913-7674efb142e5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:52.843060Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:52.842819Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:52.877856Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:52.876509Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:52.843040Z&quot;}" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>params.AtomTyper <span class="op">=</span> rdFMCS.AtomCompare.CompareElements</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>params.BondTyper <span class="op">=</span> rdFMCS.BondCompare.CompareOrder</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.RingMatchesRingOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.CompleteRingsOnly <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4b5255bb-5802-4795-acc0-e66fdd37f141" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:52.881102Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:52.879978Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:52.994359Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:52.992969Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:52.881041Z&quot;}" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="21a59b54-b243-48f7-ba3f-92c4bb469056" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:52.999790Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:52.999440Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.109988Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.109048Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:52.999763Z&quot;}" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="12a38c3e-c5bb-45ed-a6f7-0d48c94bdace" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.111119Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.110888Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.144364Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.142743Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.111098Z&quot;}" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CompareOrderOutsideRings(rdFMCS.MCSBondCompare):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, p, mol1, bond1, mol2, bond2):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        b1 <span class="op">=</span> mol1.GetBondWithIdx(bond1)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        b2 <span class="op">=</span> mol2.GetBondWithIdx(bond2)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (b1.IsInRing() <span class="kw">and</span> b2.IsInRing()) <span class="kw">or</span> (b1.GetBondType() <span class="op">==</span> b2.GetBondType()):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (p.MatchStereo <span class="kw">and</span> <span class="kw">not</span> <span class="va">self</span>.CheckBondStereo(p, mol1, bond1, mol2, bond2)):</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> p.RingMatchesRingOnly:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.CheckBondRingMatch(p, mol1, bond1, mol2, bond2)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ab20db29-c060-485b-af99-4db51031c69c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.147571Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.146861Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.206851Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.205003Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.147526Z&quot;}" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CompareElementsOutsideRings(rdFMCS.MCSAtomCompare):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, p, mol1, atom1, mol2, atom2):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        a1 <span class="op">=</span> mol1.GetAtomWithIdx(atom1)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        a2 <span class="op">=</span> mol2.GetAtomWithIdx(atom2)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (a1.GetAtomicNum() <span class="op">!=</span> a2.GetAtomicNum()) <span class="kw">and</span> <span class="kw">not</span> (a1.IsInRing() <span class="kw">and</span> a2.IsInRing()):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (p.MatchChiralTag <span class="kw">and</span> <span class="kw">not</span> <span class="va">self</span>.CheckAtomChirality(p, mol1, atom1, mol2, atom2)):</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.RingMatchesRingOnly:</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.CheckAtomRingMatch(p, mol1, atom1, mol2, atom2)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By using our more lenient atom/bond comparison criterion, while keeping the constraint that ring atoms should only match ring atoms and that rings should be complete, we retrieve a larger MCS:</p>
<div id="b6b0a3b5-6e6b-41c8-bc38-b677935e50a8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.210742Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.209759Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.318014Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.316083Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.210680Z&quot;}" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>params.AtomTyper <span class="op">=</span> CompareElementsOutsideRings()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>params.BondTyper <span class="op">=</span> CompareOrderOutsideRings()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.RingMatchesRingOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.CompleteRingsOnly <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="84d92f72-b74c-4b0f-9f09-e2223146dad7" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.321874Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.321051Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.506686Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.505570Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.321813Z&quot;}" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7bad50f1-688d-4239-b716-dd649e76c687" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.508405Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.508158Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.559501Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.558476Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.508384Z&quot;}" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that the first molecule can actually match two equivalent ring systems:</p>
<div id="4e3967a7-7708-43fa-ab5d-e8a421d6ed43" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.560683Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.560454Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.657438Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.655958Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.560663Z&quot;}" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>[m.GetSubstructMatches(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>[((1, 2, 6, 3, 7, 4, 8, 5, 9, 23, 11, 25),
  (5, 4, 6, 14, 7, 13, 8, 12, 9, 23, 11, 25)),
 ((9, 8, 10, 7, 11, 17, 13, 16, 14, 26, 15, 28),),
 ((9, 10, 8, 11, 7, 12, 6, 13, 15, 5, 14, 36),)]</code></pre>
</div>
</div>
<p>The fact that we instantiate custom compare <em>classes</em> rather than custom compare <em>functions</em> allows to put some non-molecule specific (<em>i.e.</em>, static) data that we may need for the comparison in addition to the <code>MCSParameters</code> that get passed to the <code>__call__</code> method by the MCS code.<br> We may access this data stored on the class instance inside the <code>__call__</code> method.<br> For example, let’s assume that we want to enforce that aromatic only matches aromatic based on a user-specified setting.<br> All we need to do is modify our <code>CompareOrderOutsideRings</code> as follows:</p>
<div id="85fbd1fb-2024-4bf5-9d7f-e818ca890f46" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.661295Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.660650Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.699592Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.697838Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.661241Z&quot;}" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CompareOrderOutsideRings(rdFMCS.MCSBondCompare):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, aromatic_match_aromatic<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.aromatic_match_aromatic <span class="op">=</span> aromatic_match_aromatic</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, p, mol1, bond1, mol2, bond2):</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        b1 <span class="op">=</span> mol1.GetBondWithIdx(bond1)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        b2 <span class="op">=</span> mol2.GetBondWithIdx(bond2)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ((b1.IsInRing() <span class="kw">and</span> b2.IsInRing()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">and</span> (<span class="kw">not</span> <span class="va">self</span>.aromatic_match_aromatic <span class="kw">or</span> <span class="kw">not</span> (b1.GetIsAromatic() <span class="op">^</span> b2.IsInRing())))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> b1.GetBondType() <span class="op">==</span> b2.GetBondType()):</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (p.MatchStereo <span class="kw">and</span> <span class="kw">not</span> <span class="va">self</span>.CheckBondStereo(p, mol1, bond1, mol2, bond2)):</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> p.RingMatchesRingOnly:</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.CheckBondRingMatch(p, mol1, bond1, mol2, bond2)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we instantiate the <code>CompareOrderOutsideRings</code> class without passing the <code>aromatic_match_aromatic</code> optional parameter, which defaults to <code>False</code>, we will get the same results as before:</p>
<div id="63733ae1-2afd-4e38-9ad9-9bf1623778f7" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.703371Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.702650Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.768191Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.766561Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.703272Z&quot;}" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>params.AtomTyper <span class="op">=</span> CompareElementsOutsideRings()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>params.BondTyper <span class="op">=</span> CompareOrderOutsideRings()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.RingMatchesRingOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.CompleteRingsOnly <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="afebb653-ddb4-498c-84ae-0576e92fe0af" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.772019Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.771320Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:53.972347Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:53.971371Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.771959Z&quot;}" data-tags="[]" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5590e231-ff01-43b7-9827-46d25f62fd7a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:53.973923Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:53.973683Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.020289Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.019276Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:53.973903Z&quot;}" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="6bea6f61-b42b-46e3-9907-fcdcf6922fbc" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.021364Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.021124Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.121478Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.119819Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.021343Z&quot;}" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>[m.GetSubstructMatches(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>[((1, 2, 6, 3, 7, 4, 8, 5, 9, 23, 11, 25),
  (5, 4, 6, 14, 7, 13, 8, 12, 9, 23, 11, 25)),
 ((9, 8, 10, 7, 11, 17, 13, 16, 14, 26, 15, 28),),
 ((9, 10, 8, 11, 7, 12, 6, 13, 15, 5, 14, 36),)]</code></pre>
</div>
</div>
<p>However, if we instantiate the <code>CompareOrderOutsideRings</code> class setting the <code>aromatic_match_aromatic</code> optional parameter to <code>True</code>, the first molecule will match only on the quinoline ring system:</p>
<div id="c1d4d542-0a8f-4403-ad09-cf425244cd74" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.125934Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.124980Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.177577Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.175924Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.125854Z&quot;}" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>params.AtomTyper <span class="op">=</span> CompareElementsOutsideRings()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>params.BondTyper <span class="op">=</span> CompareOrderOutsideRings(<span class="va">True</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.RingMatchesRingOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.CompleteRingsOnly <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="063907d2-99f1-4dcc-a52b-9ca96207864e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.181743Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.180845Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.314047Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.313077Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.181681Z&quot;}" data-tags="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="de6f9693-b23b-4997-97c9-59ef9e6350d8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.315487Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.315198Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.362661Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.361837Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.315462Z&quot;}" data-tags="[]" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f8574f26-f939-4e06-804f-26a66e306298" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.370834Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.370616Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.445155Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.443667Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.370814Z&quot;}" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>[m.GetSubstructMatches(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>[((4, 5, 14, 6, 13, 7, 12, 8, 11, 9, 23, 25),),
 ((8, 9, 7, 10, 17, 11, 16, 13, 15, 14, 26, 28),),
 ((10, 9, 11, 8, 12, 7, 13, 6, 14, 15, 5, 36),)]</code></pre>
</div>
</div>
</section>
<section id="retrieve-all-degenerate-mcss" class="level1">
<h1>Retrieve all degenerate MCSs</h1>
<p>It may happen that there are multiple degenerate MCSs (i.e., with the same size) across a set of molecules.<br> Before my PR, the MCS algorithm implemented in RDKit would return only one of them, but which one would be rather unpredictable, as it depends on atom ordering in the molecules.<br> This topic was raised during an RDKit UGM 2-3 years ago, but I did not realize its importance until one of my colleagues was bitten by the degenerate MCS issue.<br> Now there is an optional <code>StoreAll</code> parameter, which defaults to <code>False</code>, which if set to <code>True</code> will trigger the storage of all degenerate MCSs in an array.<br> See below for an example.</p>
<div id="cd071a58-1bb2-42fd-a9a2-b4de30ee2f38" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.448912Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.447857Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.499612Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.498083Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.448835Z&quot;}" data-tags="[]" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mols <span class="op">=</span> [Chem.MolFromSmiles(smi) <span class="cf">for</span> smi <span class="kw">in</span> [</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nc1ccc(cc1)C-Cc1c(N)cccc1"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nc1ccc(cc1)C=Cc1c(N)cccc1"</span>]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="89954638-f01d-4472-b530-d164d97d9d57" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.503750Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.502869Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.600684Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.599707Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.503689Z&quot;}" data-tags="[]" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>You can see at a glance that two degenerate MCSs can be found between the above molecules, i.e., <em>o</em>-methylaniline and <em>p</em>-methylaniline.<br> However, by default <code>rdFMCS</code> will only find one, in this case the <em>para</em> isomer:</p>
<div id="8e77e497-12da-4b2e-8294-2408aa27af2e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.602443Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.602106Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.747450Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.745856Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.602417Z&quot;}" data-tags="[]" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c21bb761-1e37-4b68-b4c6-df260a6d7ebd" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.750771Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.750212Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.795490Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.793825Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.750720Z&quot;}" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mcs.numAtoms, mcs.numBonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>(8, 8)</code></pre>
</div>
</div>
<div id="b4310ac4-5c4c-40af-a3b3-9d04f75ae486" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.799860Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.798844Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:54.925513Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:54.924410Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.799798Z&quot;}" data-tags="[]" data-execution_count="26">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mcs.queryMol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c40d20e2-57ea-4bbd-8e68-3b7bba33dc79" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:54.927504Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:54.927010Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.071218Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.070411Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:54.927469Z&quot;}" data-tags="[]" data-execution_count="27">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="0b1efaf4-a064-433c-bd26-d30543763b47" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.072185Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.071976Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.126376Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.124547Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.072166Z&quot;}" data-tags="[]" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>params.StoreAll <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ddb579ec-ebc3-4d5c-8616-98f3dcae39c0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.130377Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.129665Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.236226Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.234583Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.130316Z&quot;}" data-tags="[]" data-execution_count="29">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The number of atoms and bonds that constitute the MCS, as expected, are the same as before, since the MCSs are degenerate:</p>
<div id="ae7fd377-9633-47bb-b6c3-f09e810a5156" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.238973Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.238463Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.292839Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.291372Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.238928Z&quot;}" data-tags="[]" data-execution_count="30">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mcs.numAtoms, mcs.numBonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>(8, 8)</code></pre>
</div>
</div>
<p>However, this time <code>mcs.queryMol</code> and <code>mcs.smartsString</code> are <code>None</code> and <code>''</code>, respectively.<br> This is by design, as with <code>StoreAll</code> we need to be able to potentially access multiple MCSs, rather than only one as is the case for the <code>MCSResult.queryMol</code> and <code>MCSResult.smartsString</code> properties.<br> The property that allows to browse all degenerate MCSs is <code>MCSResult.degenerateSmartsQueryMolDict</code>, which is a <code>dict</code>:</p>
<div id="349af878-b2b9-4d35-aeaa-ed5543aca7ab" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.296544Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.295857Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.395778Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.394224Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.296484Z&quot;}" data-tags="[]" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>mcs.queryMol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="de667e44-5de0-4cc5-9334-caebb7bf7d90" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.399707Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.399033Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.517454Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.516003Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.399649Z&quot;}" data-tags="[]" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mcs.smartsString</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>''</code></pre>
</div>
</div>
<div id="c4f9fd3d-d1f1-41b7-80eb-ccf2cf4f6b09" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.521308Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.520417Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.607592Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.606129Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.521201Z&quot;}" data-tags="[]" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mcs.degenerateSmartsQueryMolDict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>{'[#6]-[#6]1:[#6]:[#6]:[#6]:[#6]:[#6]:1-[#7]': &lt;rdkit.Chem.rdchem.Mol at 0x21594654c10&gt;,
 '[#7]-[#6]1:[#6]:[#6]:[#6](:[#6]:[#6]:1)-[#6]': &lt;rdkit.Chem.rdchem.Mol at 0x215946550e0&gt;}</code></pre>
</div>
</div>
<p>Below I show all degenerate MCSs found, labelled with their respective SMARTS pattern:</p>
<div id="6fd252c8-5e16-495d-9e6e-2793b0c2f5b7" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.611129Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.610443Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.688421Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.686786Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.611069Z&quot;}" data-tags="[]" data-execution_count="34">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>mols_highlights_smarts_list <span class="op">=</span> [[mols, [m.GetSubstructMatch(query) <span class="cf">for</span> m <span class="kw">in</span> mols], [smarts <span class="cf">for</span> _ <span class="kw">in</span> mols]] <span class="cf">for</span> smarts, query <span class="kw">in</span> mcs.degenerateSmartsQueryMolDict.items()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1e87b033-d173-4844-b098-8bd568904eb3" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.692002Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.691327Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.788846Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.787128Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.691943Z&quot;}" data-tags="[]" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mols_to_display, highlight_atom_lists, legends <span class="op">=</span> [<span class="bu">sum</span>(item, []) <span class="cf">for</span> item <span class="kw">in</span> <span class="bu">map</span>(<span class="bu">list</span>, <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>mols_highlights_smarts_list)))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d2b76209-3aab-4762-9981-d8837bc72cea" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.792870Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.791991Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.905390Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.904216Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.792809Z&quot;}" data-tags="[]" data-execution_count="36">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols_to_display, molsPerRow<span class="op">=</span><span class="dv">2</span>, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>highlight_atom_lists, legends<span class="op">=</span>legends)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="finalmatchchecker" class="level1">
<h1><code>FinalMatchChecker</code></h1>
<p><code>MCSParameters.FinalMatchChecker</code> allows to implement a final check on a <em>growing</em> MCS to determine whether it should be accepted (and eventually be allowed to grow further, if possible) or discarded.<br> Just to clarify a bit, the MCS algorithm already implements some built-in, optional final match checkers, <em>e.g.</em> to check: * stereochemistry, in case <code>MCSParameters.AtomCompareParameters.MatchChiralTag</code> is set to <code>True</code> * ring fusion, in case <code>MCSParameters.BondCompareParameters.MatchFusedRings</code> is set to <code>True</code></p>
<p>By implementing a custom class derived from <code>rdFMCS.MCSFinalMatchCheck</code> you may enforce your own check.<br> For example, the following class will prevent any MCS containing nitrogen from growing further, causing it to be discarded straightaway:</p>
<div id="d4852555-e474-44d6-99f7-a9510d3fe824" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.907038Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.906778Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:55.961725Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:55.960027Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.907006Z&quot;}" data-tags="[]" data-execution_count="37">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FinalMatchCheckNoNitrogen(rdFMCS.MCSFinalMatchCheck):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, mol1, mol2, atom_idx_match, bond_idx_match, params):</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">not</span> <span class="bu">any</span>(mol1.GetAtomWithIdx(mol1_atom_idx).GetAtomicNum() <span class="op">==</span> <span class="dv">7</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>               <span class="kw">or</span> mol2.GetAtomWithIdx(mol2_atom_idx).GetAtomicNum() <span class="op">==</span> <span class="dv">7</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> mol1_atom_idx, mol2_atom_idx <span class="kw">in</span> atom_idx_match)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Taking again as an example the two molecules from above, if we blacklist nitrogen we would expect the MCS to be toluene.</p>
<div id="a515f3aa-1ce3-48e5-a908-7a01ec8b7c81" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:55.965972Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:55.964654Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.009597Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.008054Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:55.965910Z&quot;}" data-tags="[]" data-execution_count="38">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mols <span class="op">=</span> [Chem.MolFromSmiles(smi) <span class="cf">for</span> smi <span class="kw">in</span> [</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nc1ccc(cc1)C-Cc1c(N)cccc1"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nc1ccc(cc1)C=Cc1c(N)cccc1"</span>]</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3cf683d0-ba1c-4fbb-8dbb-06061fd1fba7" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.014100Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.012557Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.093981Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.093409Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.014036Z&quot;}" data-tags="[]" data-execution_count="39">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="bb5d802f-a910-4a4e-80b9-938c8be41334" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.095669Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.095309Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.141825Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.140059Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.095633Z&quot;}" data-tags="[]" data-execution_count="40">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>params.FinalMatchChecker <span class="op">=</span> FinalMatchCheckNoNitrogen()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fb41ca1d-3757-4ad4-921c-a7987a4698b4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.145714Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.145022Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.226176Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.224858Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.145654Z&quot;}" data-tags="[]" data-execution_count="41">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The number of atoms and bonds that constitute the MCS, as expected, are the same as before, since the MCSs are degenerate:</p>
<div id="520a9001-80d7-4078-af4a-4aed0ecf8b46" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.228768Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.228052Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.351303Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.349798Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.228729Z&quot;}" data-tags="[]" data-execution_count="42">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mcs.numAtoms, mcs.numBonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>(7, 7)</code></pre>
</div>
</div>
<p>And indeed, toluene is what we get:</p>
<div id="d9691741-e2e7-4c8a-9d3e-dfb63f9496ae" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.355528Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.354624Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.484396Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.483133Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.355467Z&quot;}" data-tags="[]" data-execution_count="43">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mcs.queryMol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="82aa0614-e14a-40b7-9cc5-3d605a7f605e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.486883Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.486248Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.591440Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.589974Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.486849Z&quot;}" data-tags="[]" data-execution_count="44">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mcs.smartsString</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>'[#6]1:[#6]:[#6]:[#6](:[#6]:[#6]:1)-[#6]'</code></pre>
</div>
</div>
<div id="515cfb6f-cd37-42b9-b27a-76948dabef2b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.595587Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.594687Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.717351Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.716401Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.595525Z&quot;}" data-tags="[]" data-execution_count="45">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(mcs.queryMol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-46-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="shouldacceptmcs" class="level1">
<h1><code>ShouldAcceptMCS</code></h1>
<p><code>MCSParameters.ShouldAcceptMCS</code> allows to implement a user-defined acceptance criterion on a complete MCS (which is already fully grown and potentially ready to be returned as result).<br> If the complete NCS fails the check, it will be discarded and not returned to the user.<br> A quite specific use case that we recently had internally was to find an MCS between two molecules, one of which containing a dummy atom.<br> We needed to enforce that, for the molecule containing the dummy atom, this dummy atom was actually part of the MCS.<br> We did this by using a custom <code>TerminalDummyMatchesAnyNonTerminalAtom</code> <code>AtomCompare</code> subclass and a custom <code>EnforceDummyAcceptance</code> <code>MCSAcceptance</code> subclass; see below.</p>
<div id="f6d9143f-3bee-44d5-8f5c-dacaf97ef986" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.718573Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.718339Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.810604Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.808748Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.718553Z&quot;}" data-tags="[]" data-execution_count="46">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TerminalDummyMatchesAnyNonTerminalAtom(rdFMCS.MCSAtomCompare):</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, p, mol1, atom1, mol2, atom2):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>        a1 <span class="op">=</span> mol1.GetAtomWithIdx(atom1)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        a2 <span class="op">=</span> mol2.GetAtomWithIdx(atom2)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        a1_is_dummy <span class="op">=</span> (a1.GetAtomicNum() <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        a2_is_dummy <span class="op">=</span> (a2.GetAtomicNum() <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a1_is_dummy <span class="op">^</span> a2_is_dummy:</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>            atoms <span class="op">=</span> (a1, a2)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>            dummy_atom_idx <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> a1_is_dummy <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>            other_atom_idx <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> dummy_atom_idx</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> atoms[dummy_atom_idx].GetDegree() <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> atoms[other_atom_idx].GetDegree() <span class="op">&gt;</span> <span class="dv">1</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a1.GetAtomicNum() <span class="op">!=</span> a2.GetAtomicNum():</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.CheckAtomRingMatch(p, mol1, atom1, mol2, atom2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5d8aa9cd-ac30-4d14-9022-4d1509420aae" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.814870Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.813959Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:56.961774Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:56.960000Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.814805Z&quot;}" data-tags="[]" data-execution_count="47">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EnforceDummyAcceptance(rdFMCS.MCSAcceptance):</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, mol1, mol2, atom_idx_match, bond_idx_match, params):</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> mol1_atom_idx, mol2_atom_idx <span class="kw">in</span> atom_idx_match:</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mol1.GetAtomWithIdx(mol1_atom_idx).GetAtomicNum() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mol2.GetAtomWithIdx(mol2_atom_idx).GetAtomicNum() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b7080238-a58b-4b7b-ad90-c8877dc6e806" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:56.966205Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:56.965248Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:57.024256Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:57.022348Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:56.966097Z&quot;}" data-tags="[]" data-execution_count="48">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mols <span class="op">=</span> [</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    Chem.MolFromSmiles(smi) <span class="cf">for</span> smi <span class="kw">in</span> [</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OC(=O)CCc1c(C)ccc2ccccc12"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"c1(C)cc(cccc2)c2c(*)c1"</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="50187853-8eca-4def-b44a-cde5312288ab" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:57.028545Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:57.027648Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:57.208902Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:57.208034Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:57.028482Z&quot;}" data-tags="[]" data-execution_count="49">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>If we set neither a custom <code>AtomCompare</code> class nor a custom <code>MCSAcceptance</code> but rather only request <code>BondCompareParameters.RingMatchesRingOnly</code> and <code>BondCompareParameters.CompleteRingsOnly</code> and set <code>StoreAll</code> to <code>True</code>, the only MCS found will be 2-naphthalene:</p>
<div id="bd62ab61-6808-4549-9c95-3dc93e6798b6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:57.210018Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:57.209775Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:57.452880Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:57.451120Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:57.209997Z&quot;}" data-tags="[]" data-execution_count="50">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.RingMatchesRingOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.CompleteRingsOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>params.StoreAll <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9bf70565-49a9-41c8-96f6-378c1eb8cc9c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:57.457264Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:57.456254Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:57.706769Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:57.705114Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:57.457204Z&quot;}" data-tags="[]" data-execution_count="51">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="302b32e6-cb01-439b-8fc5-b0e22f61ccb6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:57.711029Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:57.710089Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:57.971635Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:57.970098Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:57.710967Z&quot;}" data-tags="[]" data-execution_count="52">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mcs.numAtoms, mcs.numBonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>(11, 12)</code></pre>
</div>
</div>
<div id="9a403443-ec5f-48c6-8b93-b379a16446f6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:57.975176Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:57.974498Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:58.225191Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:58.223677Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:57.975116Z&quot;}" data-tags="[]" data-execution_count="53">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(mcs.degenerateSmartsQueryMolDict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>1</code></pre>
</div>
</div>
<div id="c7b34789-9a73-4961-97dc-5309b1b4311c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:58.229174Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:58.228465Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:58.471513Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:58.469709Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:58.229115Z&quot;}" data-tags="[]" data-execution_count="54">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>smarts_string, query_mol <span class="op">=</span> <span class="bu">tuple</span>(mcs.degenerateSmartsQueryMolDict.items())[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="82403fe3-d48c-4659-9d31-5c3bf4297fc3" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:58.475986Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:58.474728Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:58.673003Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:58.671259Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:58.475856Z&quot;}" data-tags="[]" data-execution_count="55">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>smarts_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>'[#6]1(-&amp;!@[#6]):&amp;@[#6]:&amp;@[#6]2:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@2:&amp;@[#6]:&amp;@[#6]:&amp;@1'</code></pre>
</div>
</div>
<div id="9b8f06d4-5bfb-446a-a4f4-100ce55afeb0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:58.676345Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:58.675675Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:58.959417Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:58.958467Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:58.676286Z&quot;}" data-tags="[]" data-execution_count="56">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(query_mol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Instead, if in addiiton to the above we specify the custom <code>TerminalDummyMatchesAnyNonTerminalAtom</code> <code>AtomCompare</code> subclass allowing dummy atoms to match any other atom, we will find two degenerate MCSs:</p>
<div id="ca5a0708-3736-4a09-a74f-9e13fc0ebfc8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:58.961714Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:58.961483Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.010901Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.009188Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:58.961695Z&quot;}" data-tags="[]" data-execution_count="57">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>params.AtomTyper <span class="op">=</span> TerminalDummyMatchesAnyNonTerminalAtom()</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.RingMatchesRingOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.CompleteRingsOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>params.StoreAll <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="03fbc692-3aed-4ecd-b94a-035936315df8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.014634Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.013962Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.118363Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.117033Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.014576Z&quot;}" data-tags="[]" data-execution_count="58">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b3bcc97e-474e-4d56-849a-55a4fa5c15f1" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.119958Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.119643Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.174581Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.173117Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.119932Z&quot;}" data-tags="[]" data-execution_count="59">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>mcs.numAtoms, mcs.numBonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>(11, 12)</code></pre>
</div>
</div>
<div id="ca158c58-eb11-49d2-bba6-383d81ce6b87" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.178706Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.177786Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.264869Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.263240Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.178643Z&quot;}" data-tags="[]" data-execution_count="60">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(mcs.degenerateSmartsQueryMolDict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>2</code></pre>
</div>
</div>
<div id="4768b7e7-6772-4ae4-89db-daa91f156eb9" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.268421Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.267745Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.330464Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.328868Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.268361Z&quot;}" data-tags="[]" data-execution_count="61">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mcs.degenerateSmartsQueryMolDict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>{'[#6]1(-&amp;!@[#6]):&amp;@[#6]:&amp;@[#6]:&amp;@[#6]2:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@2:&amp;@[#6]:&amp;@1': &lt;rdkit.Chem.rdchem.Mol at 0x215946566c0&gt;,
 '[#6]1:&amp;@[#6]:&amp;@[#6]2:&amp;@[#6](:&amp;@[#6](-&amp;!@[#0,#6]):&amp;@[#6]:&amp;@1):&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@2': &lt;rdkit.Chem.rdchem.Mol at 0x21594656810&gt;}</code></pre>
</div>
</div>
<p>Below I display I display all degenerate MCSs found, labelled with their respective SMARTS pattern:</p>
<div id="731394b3-ce3a-4020-a808-fac455e17521" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.334070Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.333396Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.433844Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.432092Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.334010Z&quot;}" data-tags="[]" data-execution_count="62">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>mols_highlights_smarts_list <span class="op">=</span> [[mols, [m.GetSubstructMatch(query) <span class="cf">for</span> m <span class="kw">in</span> mols], [smarts <span class="cf">for</span> _ <span class="kw">in</span> mols]] <span class="cf">for</span> smarts, query <span class="kw">in</span> mcs.degenerateSmartsQueryMolDict.items()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="99c9d1b0-7e42-47be-a93b-09bc1b3c69dc" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.437376Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.436709Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.467021Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.465352Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.437318Z&quot;}" data-tags="[]" data-execution_count="63">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>mols_to_display, highlight_atom_lists, legends <span class="op">=</span> [<span class="bu">sum</span>(item, []) <span class="cf">for</span> item <span class="kw">in</span> <span class="bu">map</span>(<span class="bu">list</span>, <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>mols_highlights_smarts_list)))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="542e39ce-c2c2-4284-b0bf-8d98bac115c3" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.471156Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.470275Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.557412Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.556097Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.471095Z&quot;}" data-tags="[]" data-execution_count="64">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols_to_display, molsPerRow<span class="op">=</span><span class="dv">2</span>, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>highlight_atom_lists, legends<span class="op">=</span>legends)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As expected, since we allowed terminal dummies to match any non-terminal atom, we get both 1- and 2-naphthalene as degenerate MCSs.</p>
<p>Finally, if in addition to the above we also use <code>EnforceDummyAcceptance</code> as custom <code>MCSAcceptance</code> criterion enforcing that the dummy atom should be part of the MCS if possible, we will again get a single MCS, i.e.&nbsp;1-naphthalene as it is the only one including the dummy atom:</p>
<div id="79a5b21a-eb2c-418b-b887-771d580f839b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.558382Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.558161Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.611045Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.609151Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.558364Z&quot;}" data-tags="[]" data-execution_count="65">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> rdFMCS.MCSParameters()</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>params.AtomTyper <span class="op">=</span> TerminalDummyMatchesAnyNonTerminalAtom()</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.RingMatchesRingOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>params.BondCompareParameters.CompleteRingsOnly <span class="op">=</span> <span class="va">True</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>params.ShouldAcceptMCS <span class="op">=</span> EnforceDummyAcceptance()</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>params.StoreAll <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f63df182-709e-4872-97a0-4d5019c03391" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.631181Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.630419Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.665869Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.664744Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.631132Z&quot;}" data-tags="[]" data-execution_count="66">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>mcs <span class="op">=</span> rdFMCS.FindMCS(mols, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="97c99768-cab9-4cc8-b314-8a7a4e732e1d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.667097Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.666856Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.674669Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.673705Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.667078Z&quot;}" data-tags="[]" data-execution_count="67">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>mcs.numAtoms, mcs.numBonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>(11, 12)</code></pre>
</div>
</div>
<div id="0eef86a6-0c15-431f-a815-65fe1d1c34a8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.676192Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.675909Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.707362Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.705787Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.676168Z&quot;}" data-tags="[]" data-execution_count="68">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(mcs.degenerateSmartsQueryMolDict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>1</code></pre>
</div>
</div>
<div id="f7c3b1ab-b527-4b83-9f27-3a04f11e0f8f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.711297Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.710593Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.751614Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.749942Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.711237Z&quot;}" data-tags="[]" data-execution_count="69">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>smarts_string, query_mol <span class="op">=</span> <span class="bu">tuple</span>(mcs.degenerateSmartsQueryMolDict.items())[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6001fcbd-7162-469f-bc66-d8a62bbd4a5d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.755573Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.754877Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.876251Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.874666Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.755513Z&quot;}" data-tags="[]" data-execution_count="70">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>smarts_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>'[#6]1:&amp;@[#6]:&amp;@[#6]2:&amp;@[#6](:&amp;@[#6](-&amp;!@[#0,#6]):&amp;@[#6]:&amp;@1):&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@[#6]:&amp;@2'</code></pre>
</div>
</div>
<div id="41c439de-cbb0-48de-8c63-ab2b4fc82f9a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-10-24T09:01:59.880238Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-24T09:01:59.879546Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-24T09:01:59.977067Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-24T09:01:59.976143Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-24T09:01:59.880178Z&quot;}" data-tags="[]" data-execution_count="71">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>MolsToGridImage(mols, subImgSize<span class="op">=</span>(<span class="dv">300</span>, <span class="dv">200</span>), highlightAtomLists<span class="op">=</span>[m.GetSubstructMatch(query_mol) <span class="cf">for</span> m <span class="kw">in</span> mols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>
<figure class="figure">
<p><img src="2023-10-27-mcswhatsnew_files/figure-html/cell-72-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/greglandrum\.github\.io\/rdkit-blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="greglandrum/rdkit-blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright (C) 2025 Greg Landrum</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><a href="https://www.rdkit.org"><img src="https://www.rdkit.org/logo.small.png" class="img-fluid" alt="RDKit" width="64"></a></p>
</div>
  </div>
</footer>




</body></html>